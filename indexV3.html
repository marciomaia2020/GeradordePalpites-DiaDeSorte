<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gerador de Palpites Baseado em dígitos- Dia de Sorte</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#5D5CDE',
                    }
                }
            },
            darkMode: 'class',
        }
    </script>
    <style>
        @media print {
            .no-print {
                display: none;
            }
            .page-break {
                page-break-after: always;
            }
        }
        
        footer {
                color: #161515;
                text-align: center;
                padding: 5px;
                margin-bottom: auto;
                margin-top: 10px; /* Espaço acima do rodapé */
        }
        .small{
                font-size: 16px;
                font-style: italic;
        }
        
        .toggle-btn {
            cursor: pointer;
            transition: transform 0.3s ease;
        }
        
        .toggle-btn.active {
            transform: rotate(180deg);
        }
        
        .transition-height {
            transition: max-height 0.5s ease-out;
            overflow: hidden;
        }
        
        .number-low {
            background-color: rgba(134, 239, 172, 0.9);
            color: rgb(22, 101, 52);
        }
        
        .dark .number-low {
            background-color: rgba(22, 101, 52, 0.7);
            color: rgb(187, 247, 208);
        }
        
        .number-medium {
            background-color: rgba(253, 230, 138, 0.9);
            color: rgb(146, 64, 14);
        }
        
        .dark .number-medium {
            background-color: rgba(146, 64, 14, 0.7);
            color: rgb(254, 240, 138);
        }
        
        .number-high {
            background-color: rgba(252, 165, 165, 0.9);
            color: rgb(153, 27, 27);
        }
        
        .dark .number-high {
            background-color: rgba(153, 27, 27, 0.7);
            color: rgb(254, 202, 202);
        }
        
        /* Estilos para exibição da frequência das dezenas */
        .frequency-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 8px;
        }
        
        .frequency-ball {
            position: relative;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: bold;
            background-color: #f3f4f6;
            border: 2px solid transparent;
            color: #1f2937;
            margin: 0 auto;
        }
        
        .dark .frequency-ball {
            background-color: #374151;
            color: #f3f4f6;
        }
        
        .freq-low {
            border-color: #10b981;
        }
        
        .freq-medium {
            border-color: #f59e0b;
        }
        
        .freq-high {
            border-color: #ef4444;
        }
        
        /* Nova animação de pulsação para o número mais frequente */
        @keyframes maxFreqPulse {
            0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.7); }
            50% { transform: scale(1.1); box-shadow: 0 0 0 10px rgba(239, 68, 68, 0); }
            100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(239, 68, 68, 0); }
        }
        
        .freq-max {
            animation: maxFreqPulse 1.5s infinite;
            z-index: 5;
            border-width: 3px !important;
            border-color: #ef4444 !important;
        }
        
        .dark .freq-max {
            border-color: #f87171 !important;
        }
        
        .freq-value {
            position: absolute;
            top: -8px;
            right: -8px;
            background-color: #4b5563;
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            font-size: 0.7rem;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        /* Estilos para o mês da sorte */
        .month-ball {
            padding: 2px 6px;
            border-radius: 12px;
            background-color: #8b5cf6;
            color: white;
            font-weight: bold;
            font-size: 0.8rem;
        }
        
        .dark .month-ball {
            background-color: #7c3aed;
        }
        
        /* Destacar mês mais frequente */
        .month-highlight {
            box-shadow: 0 0 0 3px #fbbf24, 0 0 10px #fbbf24;
            animation: pulse 1.5s infinite;
        }
        
        /* Estilos para os padrões de dígitos */
        .pattern-bar {
            height: 20px;
            background-color: #0d9488;
            border-radius: 4px;
            transition: width 1s ease-out;
        }
        
        .dark .pattern-bar {
            background-color: #14b8a6;
        }
        
        .pattern-example {
            background-color: rgba(13, 148, 136, 0.2);
            transition: background-color 0.3s;
        }
        
        .pattern-example:hover {
            background-color: rgba(13, 148, 136, 0.4);
        }
        
        .dark .pattern-example {
            background-color: rgba(20, 184, 166, 0.2);
        }
        
        .dark .pattern-example:hover {
            background-color: rgba(20, 184, 166, 0.4);
        }
        
        /* Estilo para botão de mostrar mais padrões */
        .show-more-btn {
            cursor: pointer;
            padding: 5px 10px;
            background-color: #0d9488;
            color: white;
            border-radius: 4px;
            font-size: 0.9rem;
            margin-top: 8px;
            display: inline-block;
            transition: background-color 0.3s;
        }
        
        .show-more-btn:hover {
            background-color: #0f766e;
        }
        
        .dark .show-more-btn {
            background-color: #14b8a6;
        }
        
        .dark .show-more-btn:hover {
            background-color: #0d9488;
        }
        
        /* Estilo para padrões escondidos */
        .hidden-patterns {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.5s ease-out;
        }
        
        .hidden-patterns.visible {
            max-height: 1000px;
        }
        
        /* Estilos para a seleção de padrões */
        .pattern-selector {
            padding: 10px;
            background-color: rgba(13, 148, 136, 0.1);
            border-radius: 8px;
            margin-top: 16px;
        }
        
        .pattern-checkbox {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
            padding: 6px;
            border-radius: 4px;
            transition: background-color 0.3s;
        }
        
        .pattern-checkbox:hover {
            background-color: rgba(13, 148, 136, 0.2);
        }
        
        .pattern-checkbox input[type="checkbox"] {
            margin-right: 8px;
            width: 18px;
            height: 18px;
        }
        
        @keyframes pulse {
            0% { box-shadow: 0 0 0 2px rgba(251, 191, 36, 0.7); }
            70% { box-shadow: 0 0 0 5px rgba(251, 191, 36, 0); }
            100% { box-shadow: 0 0 0 2px rgba(251, 191, 36, 0); }
        }
        
        /* Estilos para o modal popup */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            overflow-y: auto;
        }
        
        .modal-content {
            background-color: white;
            margin: 2rem auto;
            max-width: 90%;
            width: 800px;
            border-radius: 8px;
            position: relative;
        }
        
        .dark .modal-content {
            background-color: #1f2937;
            color: #e5e7eb;
        }
        
        .modal-header {
            padding: 1rem;
            border-bottom: 1px solid #e2e8f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .dark .modal-header {
            border-bottom: 1px solid #4b5563;
        }
        
        .modal-body {
            padding: 1.5rem;
            max-height: 70vh;
            overflow-y: auto;
        }
        
        .modal-footer {
            padding: 1rem;
            border-top: 1px solid #e2e8f0;
            text-align: right;
        }
        
        .dark .modal-footer {
            border-top: 1px solid #4b5563;
        }
        
        .close-btn {
            cursor: pointer;
            font-size: 1.5rem;
            font-weight: bold;
        }
        
        /* Animação para as barras de estatística */
        @keyframes barGrow {
            from { height: 0%; }
            to { height: var(--target-height); }
        }
        
        .stat-bar-group .stat-bar {
            animation: barGrow 1s ease-out forwards;
        }
        
        /* Spinner para carregamento */
        @keyframes spinner {
            to {transform: rotate(360deg);}
        }
        
        .spinner {
            display: inline-block;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-top-color: white;
            animation: spinner 0.8s linear infinite;
        }

        /* Barra de progresso animada */
        @keyframes progressBarAnimation {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        .progress-bar {
            height: 8px;
            border-radius: 4px;
            background: linear-gradient(90deg, #3b82f6, #8b5cf6, #3b82f6);
            background-size: 200% 200%;
            animation: progressBarAnimation 2s linear infinite;
        }
        
		/* Estilos para o misturador de palpites */
		.mixer-section {
			background-color: #f0f9ff;
			border-radius: 8px;
			padding: 12px;
			margin-bottom: 16px;
		}

		.dark .mixer-section {
			background-color: #0c4a6e;
		}

		.mixer-card {
			border: 1px solid #cbd5e1;
			border-radius: 8px;
			padding: 12px;
			margin-bottom: 8px;
			background-color: white;
			transition: all 0.2s ease;
		}

		.mixer-card:hover {
			border-color: #5D5CDE;
			box-shadow: 0 2px 8px rgba(93, 92, 222, 0.2);
		}

		.dark .mixer-card {
			background-color: #1e293b;
			border-color: #334155;
		}

		.dark .mixer-card:hover {
			border-color: #818cf8;
			box-shadow: 0 2px 8px rgba(129, 140, 248, 0.2);
		}
    </style>
</head>
<body class="bg-white dark:bg-gray-900 text-gray-800 dark:text-gray-200 min-h-screen">
    <!-- Dark mode detection -->
    <script>
        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            document.documentElement.classList.add('dark');
        }
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
            if (event.matches) {
                document.documentElement.classList.add('dark');
            } else {
                document.documentElement.classList.remove('dark');
            }
        });
    </script>

    <!-- Modal de Instruções -->
    <div id="instructionsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="text-2xl font-bold text-primary">Como Usar o Gerador de Palpites - Dia de Sorte</h2>
                <span class="close-btn" id="closeModal">&times;</span>
            </div>
            <div class="modal-body">
                <div class="space-y-6">
                    <section>
                        <h3 class="text-xl font-semibold text-primary mb-2">Introdução</h3>
                        <p class="mb-2">Este aplicativo utiliza uma abordagem matemática para gerar palpites para a loteria Dia de Sorte, baseando-se em combinações de dígitos que ainda não foram sorteadas.</p>
                        <p>A estratégia principal é identificar quais combinações de 5 dígitos (de 0 a 9) nunca apareceram nos sorteios anteriores, maximizando suas chances ao jogar exclusivamente com estas combinações inexploradas.</p>
                    </section>
                    
                    <section>
                        <h3 class="text-xl font-semibold text-primary mb-2">Passo a Passo</h3>
                        
                        <div class="mb-4">
                            <h4 class="font-bold">1. Analisar Resultados Anteriores</h4>
                            <ul class="list-disc pl-6 mt-1 mb-2">
                                <li>Expanda a seção "Análise de Frequência de Resultados Anteriores"</li>
                                <li>Clique em "Buscar Resultados" para importar os sorteios passados automaticamente, ou</li>
                                <li>Cole manualmente os resultados na caixa de texto (cada linha deve conter os números de um sorteio)</li>
                                <li>Clique em "Analisar Frequência" para processar os dados</li>
                            </ul>
                            <p class="text-sm italic">O sistema identificará quais combinações de 5 dígitos nunca foram sorteadas. Estas serão automaticamente usadas para gerar seus palpites.</p>
                        </div>
                        
                        <div class="mb-4">
                            <h4 class="font-bold">2. Configurar Parâmetros (opcional)</h4>
                            <ul class="list-disc pl-6 mt-1 mb-2">
                                <li>Expanda a seção "Configurações"</li>
                                <li>Ajuste a quantidade de dezenas por palpite (7 a 15)</li>
                                <li>Configure a distribuição desejada de números baixos, médios e altos</li>
                            </ul>
                            <p class="text-sm italic">Recomendamos manter a configuração padrão para uma distribuição equilibrada.</p>
                        </div>
                        
                        <div class="mb-4">
                            <h4 class="font-bold">3. Gerar Palpites</h4>
                            <ul class="list-disc pl-6 mt-1 mb-2">
                                <li>Clique no botão "Gerar Palpites" na seção de Configurações</li>
                                <li>Os palpites serão gerados utilizando apenas as combinações que nunca foram sorteadas</li>
                                <li>Você pode filtrar os resultados por categoria (baixas, médias, altas) usando as abas</li>
                            </ul>
                        </div>
                        
                        <div class="mb-4">
                            <h4 class="font-bold">4. Explorar Combinações Específicas (opcional)</h4>
                            <ul class="list-disc pl-6 mt-1 mb-2">
                                <li>Expanda a seção "Gerador por Combinação Específica"</li>
                                <li>Selecione uma combinação de dígitos específica (as não sorteadas terão um ★)</li>
                                <li>Clique em "Gerar Palpites" para ver todas as combinações possíveis para aquele conjunto de dígitos</li>
                            </ul>
                        </div>
                        
                        <div class="mb-4">
                            <h4 class="font-bold">5. Explorar Padrões de Dígitos</h4>
                            <ul class="list-disc pl-6 mt-1 mb-2">
                                <li>Na seção "Análise de Frequência", observe os padrões de dígitos iniciais e finais</li>
                                <li>Veja quais padrões são mais frequentes nos sorteios anteriores</li>
                                <li>Use o botão "Gerar Palpites baseados nos Padrões" para criar jogos que seguem esses padrões</li>
                                <li>Selecione padrões específicos e quantidade de palpites desejada</li>
                            </ul>
                        </div>
                        
                        <div class="mb-4">
                            <h4 class="font-bold">6. Exportar seus Palpites</h4>
                            <ul class="list-disc pl-6 mt-1 mb-2">
                                <li>Use o botão "Somente Dezenas" para baixar apenas os números</li>
                                <li>Use o botão "Baixar Detalhado" para um relatório completo com estatísticas</li>
                                <li>Para imprimir, use o botão "Imprimir" na seção de Configurações</li>
                            </ul>
                        </div>
                    </section>
                    
                    <section>
                        <h3 class="text-xl font-semibold text-primary mb-2">Seções da Aplicação</h3>
                        
                        <div class="mb-3">
                            <h4 class="font-bold">Combinações de Dígitos</h4>
                            <p>Mostra as combinações de 5 dígitos que serão usadas para gerar os palpites. Após a análise, mostrará apenas as combinações que nunca foram sorteadas.</p>
                        </div>
                        
                        <div class="mb-3">
                            <h4 class="font-bold">Análise de Frequência</h4>
                            <p>Permite inserir e analisar resultados anteriores, identificando quais combinações de dígitos já apareceram e quais ainda não foram sorteadas.</p>
                        </div>
                        
                        <div class="mb-3">
                            <h4 class="font-bold">Padrões de Dígitos</h4>
                            <p>Analisa os dígitos iniciais e finais dos números sorteados, mostrando os padrões mais frequentes e permitindo gerar palpites baseados neles.</p>
                        </div>
                        
                        <div class="mb-3">
                            <h4 class="font-bold">Tabela de Combinações</h4>
                            <p>Mostra em detalhes todas as combinações disponíveis e quais números cada uma pode gerar.</p>
                        </div>
                        
                        <div class="mb-3">
                            <h4 class="font-bold">Resumo Estatístico</h4>
                            <p>Fornece estatísticas sobre as combinações e quantos números cada uma gera.</p>
                        </div>
                        
                        <div class="mb-3">
                            <h4 class="font-bold">Gerador por Combinação Específica</h4>
                            <p>Permite gerar todos os palpites possíveis para uma combinação específica de dígitos.</p>
                        </div>
                        
                        <div class="mb-3">
                            <h4 class="font-bold">Palpites Gerados</h4>
                            <p>Exibe todos os palpites gerados a partir das combinações selecionadas.</p>
                        </div>
                    </section>
                    
                    <section class="bg-blue-50 dark:bg-blue-900 p-4 rounded-lg">
                        <h3 class="text-xl font-semibold text-blue-700 dark:text-blue-300 mb-2">Resumo</h3>
                        <ol class="list-decimal pl-6 space-y-2 text-blue-800 dark:text-blue-200">
                            <li>Busque ou insira resultados anteriores da Dia de Sorte</li>
                            <li>Clique em "Analisar Frequência" para identificar combinações não sorteadas</li>
                            <li>Observe os padrões de dígitos mais frequentes nos sorteios anteriores</li>
                            <li>Ajuste as configurações conforme desejado (quantidade de dezenas, distribuição)</li>
                            <li>Clique em "Gerar Palpites" para criar jogos baseados apenas nas combinações nunca sorteadas</li>
                            <li>Exporte seus palpites usando os botões de download ou impressão</li>
                        </ol>
                        <p class="mt-4 font-bold text-blue-700 dark:text-blue-300">Jogando apenas com combinações que nunca apareceram, você estará apostando em padrões matemáticos ainda não explorados nos sorteios!</p>
                    </section>
                </div>
            </div>
            <div class="modal-footer">
                <button id="closeModalBtn" class="bg-primary hover:bg-primary/90 text-white py-2 px-6 rounded">Entendi</button>
            </div>
        </div>
    </div>

    <div class="container mx-auto px-4 py-8">
        <div class="flex justify-between items-center mb-6">
            <h1 class="text-3xl font-bold text-center text-primary">Gerador de Palpites - Dia de Sorte </span></h1> 
            
            <ul>
                <li><a href="Selecao-De-Digitos.html">Digitos</a></li>
                <li><a href="Combinacoes.html">Combinacoes</a></li>
            </ul>

            <button id="showInstructionsBtn" class="bg-gray-200 hover:bg-gray-300 dark:bg-gray-700 dark:hover:bg-gray-600 text-gray-800 dark:text-gray-200 py-2 px-4 rounded flex items-center">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-3a1 1 0 00-.867.5 1 1 0 11-1.731-1A3 3 0 0113 8a3.001 3.001 0 01-2 2.83V11a1 1 0 11-2 0v-1a1 1 0 011-1 1 1 0 100-2zm0 8a1 1 0 100-2 1 1 0 000 2z" clip-rule="evenodd" />
                </svg>
                Como Usar
            </button>
        </div>
        
        <!-- Seção: Combinações de Dígitos -->
        <div class="mb-6">
            <div class="flex items-center justify-between cursor-pointer mb-2" id="digitCombinationsHeader">
                <h2 class="text-xl font-semibold flex items-center">
                    <span>Combinações de Dígitos</span> 
                    <span class="text-sm font-bold ml-2 bg-blue-100 dark:bg-blue-800 text-blue-800 dark:text-blue-200 px-2 py-0.5 rounded-full">(126)</span>
                </h2>
                <svg class="h-6 w-6 text-gray-500 dark:text-gray-400 toggle-btn" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                </svg>
            </div>
            <div id="digitCombinationsContainer" class="transition-height bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-700 rounded p-4" style="max-height: 0px; overflow: hidden;">
                <textarea id="digitCombinations" rows="6" class="w-full p-2 border rounded dark:bg-gray-800 dark:border-gray-700 text-base" readonly></textarea>
            </div>
        </div>
        
        <!-- Seção: Configurações -->
        <div class="mb-6">
            <div class="flex items-center justify-between cursor-pointer mb-2" id="configHeader">
                <h2 class="text-xl font-semibold">Configurações</h2>
                <svg class="h-6 w-6 text-gray-500 dark:text-gray-400 toggle-btn" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                </svg>
            </div>
            <div id="configContainer" class="transition-height bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-700 rounded" style="max-height: 500px; overflow: hidden;">
                <div class="space-y-4 bg-gray-100 dark:bg-gray-800 p-4 rounded">
                    <div>
                        <label class="block mb-1">Quantidade de dezenas por palpite:</label>
                        <input type="number" id="numberPerBet" value="7" min="7" max="15" class="p-2 border rounded w-full dark:bg-gray-700 dark:border-gray-600 text-base">
                    </div>
                    <!-- Campo de número máximo removido, agora é fixo em 31 e oculto -->
                    <input type="hidden" id="maxNumber" value="31">
                    <div>
                        <label class="block mb-1">Distribuição por faixa:</label>
                        <div class="flex flex-wrap gap-2">
                            <div class="flex items-center gap-1">
                                <label for="lowRange" class="whitespace-nowrap">Baixas (1-10):</label>
                                <input type="number" id="lowRange" value="3" min="0" max="15" class="p-2 border rounded w-14 dark:bg-gray-700 dark:border-gray-600 text-base">
                            </div>
                            <div class="flex items-center gap-1">
                                <label for="mediumRange" class="whitespace-nowrap">Médias (11-20):</label>
                                <input type="number" id="mediumRange" value="3" min="0" max="15" class="p-2 border rounded w-14 dark:bg-gray-700 dark:border-gray-600 text-base">
                            </div>
                            <div class="flex items-center gap-1">
                                <label for="highRange" class="whitespace-nowrap">Altas (21-31):</label>
                                <input type="number" id="highRange" value="1" min="0" max="15" class="p-2 border rounded w-14 dark:bg-gray-700 dark:border-gray-600 text-base">
                            </div>
                        </div>
                        <div id="distributionSummary" class="text-sm mt-1 mb-2 text-gray-600 dark:text-gray-400"></div>
                    </div>
                    <div class="flex gap-2 mt-4">
                        <button id="generateBtn" class="bg-indigo-600 hover:bg-indigo-700 text-white font-medium py-2 px-6 rounded">
                            Gerar Palpites
                        </button>
                        <button id="printBtn" class="bg-gray-500 hover:bg-gray-600 text-white font-medium py-2 px-6 rounded">
                            Imprimir
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Seção: Análise de Frequência -->
        <div class="mb-6">
            <div class="flex items-center justify-between cursor-pointer mb-2" id="frequencyHeader">
                <h2 class="text-xl font-semibold">Análise de Frequência de Resultados Anteriores</h2>
                <svg class="h-6 w-6 text-gray-500 dark:text-gray-400 toggle-btn" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                </svg>
            </div>
            <div id="frequencyContainer" class="transition-height bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-700 rounded" style="max-height: 500px; overflow: hidden;">
                <div class="p-4">
                    <div class="mb-4">
                        <label class="block mb-1">Cole os resultados do Dia de Sorte (um por linha, números separados por espaço):</label>
                        <textarea id="historicalResults" rows="6" placeholder="Ex: 01 03 07 13 18 27 29 Jan
04 07 09 10 14 20 25 Fev" class="w-full p-2 border rounded dark:bg-gray-800 dark:border-gray-700 text-base"></textarea>
                        <div class="text-xs text-gray-500 dark:text-gray-400 mt-1">
                            Formato: "01 02 03 04 05 06 07 Jan" (incluindo o mês da sorte ao final se disponível)
                        </div>
                    </div>
                    <div class="flex flex-wrap gap-2 mb-4">
                        <button id="analyzeBtn" class="bg-primary hover:bg-primary/90 text-white font-bold py-2 px-4 rounded">
                            Analisar Frequência
                        </button>
						<div class="flex gap-2">
							<button id="fetchResultsBtn" class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded flex items-center">
								<span id="fetchText">Buscar Resultados</span>
								<span id="loadingSpinner" class="spinner ml-2 hidden"></span>
							</button>
							<button id="clearCacheBtn" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">
								Atualizar Cache
							</button>
						</div>
                    </div>
                    <!-- Contador de concursos -->
					<div id="concursosCounter" class="mb-4 p-3 bg-gray-100 dark:bg-gray-800 rounded hidden">
						<div class="flex items-center text-gray-800 dark:text-gray-200">
							<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-primary mr-2" viewBox="0 0 20 20" fill="currentColor">
								<path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z" />
								<path fill-rule="evenodd" d="M4 5a2 2 0 012-2 3 3 0 003 3h2a3 3 0 003-3 2 2 0 012 2v11a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3zm-3 4a1 1 0 100 2h.01a1 1 0 100-2H7zm3 0a1 1 0 100 2h3a1 1 0 100-2h-3z" clip-rule="evenodd" />
							</svg>
							<span><strong id="concursosCount">0</strong> concursos encontrados e analisados</span>
						</div>
					</div>
                    <!-- Cache status indicator -->
                    <div id="cacheIndicator" class="hidden mb-4 p-3 bg-blue-50 dark:bg-blue-900 rounded">
                        <div class="flex items-center">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-blue-500 mr-2" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm0-2a6 6 0 100-12 6 6 0 000 12z" clip-rule="evenodd" />
                                <path fill-rule="evenodd" d="M10 7a1 1 0 00-1 1v3a1 1 0 002 0V8a1 1 0 00-1-1z" clip-rule="evenodd" />
                            </svg>
                            <span>Dados em cache. <span id="cacheTimerIndicator">Atualização em: calculando...</span></span>
                        </div>
                    </div>
                    
                    <!-- Status da API - Redesenhado e mais visível -->
                    <div id="apiStatus" class="mb-4 p-4 bg-blue-50 dark:bg-blue-900/30 rounded-md border border-blue-200 dark:border-blue-800 hidden">
                        <div class="font-semibold mb-2 text-blue-700 dark:text-blue-300">Status da busca:</div>
                        <div id="apiStatusContent" class="text-sm space-y-2"></div>
                        
                        <!-- Barra de progresso - novo elemento -->
                        <div class="mt-3 w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2 mb-1 overflow-hidden">
                            <div id="progressBar" class="progress-bar" style="width: 0%"></div>
                        </div>
                        <div class="text-xs text-right text-gray-500 dark:text-gray-400">
                            <span id="progressText">0%</span> concluído
                        </div>
                        
                        <!-- Log de requisições - para debug -->
                        <div class="mt-4">
                            <details>
                                <summary class="cursor-pointer text-xs text-blue-600 dark:text-blue-400">Ver detalhes técnicos</summary>
                                <div id="requestLog" class="mt-2 max-h-32 overflow-y-auto text-xs bg-gray-100 dark:bg-gray-800 p-2 rounded font-mono"></div>
                            </details>
                        </div>
                    </div>
                    
                    <div id="frequencyAnalysis" class="mt-4">
                        <div id="frequencyResults" class="hidden">
                            <!-- O conteúdo dos resultados de frequência será inserido aqui via JavaScript -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Seção: Tabela de Combinações -->
        <div class="mb-8">
            <div class="flex items-center justify-between cursor-pointer mb-2" id="combinationsToggleHeader">
                <h2 class="text-xl font-semibold">Tabela de Combinações</h2>
                <svg class="h-6 w-6 text-gray-500 dark:text-gray-400 toggle-btn" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                </svg>
            </div>
            <div id="combinationsTableContainer" class="transition-height bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-700 rounded overflow-x-auto" style="max-height: 0px;">
                <div id="combinationsTable">
                    <table class="min-w-full divide-y divide-gray-300 dark:divide-gray-700">
                        <thead>
                            <tr class="bg-gray-100 dark:bg-gray-700">
                                <th class="px-2 py-2 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Dígitos</th>
                                <th class="px-2 py-2 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Números Possíveis</th>
                                <th class="px-2 py-2 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Total</th>
                            </tr>
                        </thead>
                        <tbody id="combinationsTableBody" class="divide-y divide-gray-200 dark:divide-gray-700">
                            <!-- O conteúdo será inserido dinamicamente -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Seção: Resumo Estatístico -->
        <div class="mb-8">
            <div class="flex items-center justify-between cursor-pointer mb-2" id="statsHeader">
                <h2 class="text-xl font-semibold">Resumo Estatístico</h2>
                <svg class="h-6 w-6 text-gray-500 dark:text-gray-400 toggle-btn" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                </svg>
            </div>
            <div id="statsContainer" class="transition-height bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-700 rounded" style="max-height: 0px; overflow: hidden;">
                <div id="statisticsSummary" class="p-4">
                    <div id="statisticsContent" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                        <!-- Conteúdo será inserido dinamicamente -->
                    </div>
                    <div id="statisticsTotal" class="mt-4 font-bold border-t pt-2 dark:border-gray-700">
                        <!-- Total será inserido aqui -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Seção: Gerador por Combinação Específica -->
        <div class="mb-8">
            <div class="flex items-center justify-between cursor-pointer mb-2" id="specificHeader">
                <h2 class="text-xl font-semibold">Gerador por Combinação Específica</h2>
                <svg class="h-6 w-6 text-gray-500 dark:text-gray-400 toggle-btn" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                </svg>
            </div>
            <div id="specificContainer" class="transition-height bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-700 rounded" style="max-height: 0px; overflow: hidden;">
                <div class="p-4">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                        <div>
                            <label class="block mb-2">Selecione uma combinação de dígitos:</label>
                            <select id="specificCombination" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 text-base">
                                <!-- Será preenchido dinamicamente -->
                            </select>
                        </div>
                        <div>
                            <label class="block mb-2">Dezenas por palpite:</label>
                            <div class="flex gap-4">
                                <input type="number" id="specificNumberPerBet" value="7" min="5" max="15" class="p-2 border rounded w-full dark:bg-gray-700 dark:border-gray-600 text-base">
                                <button id="generateSpecificBtn" class="bg-primary hover:bg-primary/90 text-white font-bold py-2 px-4 rounded whitespace-nowrap">
                                    Gerar Palpites
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="mb-4">
                        <div class="bg-gray-100 dark:bg-gray-700 p-3 rounded">
                            <div class="flex items-center mb-2">
                                <span class="font-semibold mr-2">Dezenas possíveis para esta combinação:</span>
                                <span id="possibleNumberCount" class="bg-primary text-white px-3 py-1 rounded-full font-bold">0</span>
                            </div>
                            <div id="possibleNumbersDisplay" class="flex flex-wrap gap-2"></div>
                        </div>
                    </div>

                    <div class="mb-4 flex flex-wrap gap-2 justify-between items-center">
                        <div>
                            <span class="font-semibold">Total de palpites gerados: </span>
                            <span id="specificBetCount" class="bg-primary/10 dark:bg-primary/20 text-primary px-2 py-1 rounded-full font-bold">0</span>
                        </div>
                        <div class="flex gap-2">
                            <button id="downloadSpecificSimpleBtn" class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded flex items-center disabled:opacity-50 disabled:cursor-not-allowed">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor">
                                    <path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z" clip-rule="evenodd" />
                                </svg>
                                Somente Dezenas
                            </button>
                            <button id="downloadSpecificBtn" class="bg-primary hover:bg-primary/90 text-white font-bold py-2 px-4 rounded flex items-center disabled:opacity-50 disabled:cursor-not-allowed">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor">
                                    <path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z" clip-rule="evenodd" />
                                </svg>
                                Baixar Detalhado
                            </button>
                        </div>
                    </div>

                    <div id="specificBetsResults" class="border-t dark:border-gray-700 pt-4">
                        <div id="specificResultsContainer" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                            <!-- Resultados dinâmicos serão mostrados aqui -->
                        </div>
                        
                        <!-- Paginação -->
                        <div id="paginationContainer" class="mt-6 flex justify-center items-center space-x-2">
                            <button id="prevPageBtn" class="bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-200 font-bold py-2 px-4 rounded disabled:opacity-50 disabled:cursor-not-allowed">
                                Anterior
                            </button>
                            <span id="paginationInfo" class="text-sm px-2">Página 1 de 1</span>
                            <button id="nextPageBtn" class="bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-200 font-bold py-2 px-4 rounded disabled:opacity-50 disabled:cursor-not-allowed">
                                Próxima
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
		<!-- Seção: Misturador de Palpites (NOVA) -->
		<div class="mb-8">
			<div class="flex items-center justify-between cursor-pointer mb-2" id="mixerHeader">
				<h2 class="text-xl font-semibold flex items-center">
					<span>Misturador de Palpites</span> 
					<span class="text-sm font-bold ml-2 bg-blue-100 dark:bg-blue-800 text-blue-800 dark:text-blue-200 px-2 py-0.5 rounded-full">NOVO</span>
				</h2>
				<svg class="h-6 w-6 text-gray-500 dark:text-gray-400 toggle-btn" fill="none" viewBox="0 0 24 24" stroke="currentColor">
					<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
				</svg>
			</div>
			<div id="mixerContainer" class="transition-height bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-700 rounded" style="max-height: 0px; overflow: hidden;">
				<div class="p-4">
					<div class="mb-6 bg-blue-50 dark:bg-blue-900 p-4 rounded-lg">
						<h3 class="text-lg font-semibold text-blue-800 dark:text-blue-200 mb-2">Crie um Conjunto Personalizado de Palpites</h3>
						<p class="text-blue-700 dark:text-blue-300 mb-3">
							Esta funcionalidade permite combinar palpites de diferentes seções do aplicativo. Você pode selecionar quantos palpites deseja 
							de cada seção e criar um conjunto personalizado que mistura diversas estratégias.
						</p>
					</div>
					
					<div class="mb-4">
						<label class="block font-medium mb-2">Quantidade total de palpites a gerar:</label>
						<input type="number" id="totalMixedBets" min="1" max="50" value="20" class="p-2 border rounded w-full sm:w-48 dark:bg-gray-700 dark:border-gray-600 text-base">
					</div>
					
					<div class="space-y-4">
						<div class="mixer-section">
							<h3 class="text-lg font-semibold mb-3">Selecione a quantidade de palpites de cada seção:</h3>
							
							<div class="grid grid-cols-1 md:grid-cols-2 gap-4">
								<div class="mixer-card">
									<div class="flex justify-between items-center mb-2">
										<h4 class="font-medium">Seção Configurações</h4>
										<div class="text-xs px-2 py-1 bg-gray-200 dark:bg-gray-700 rounded-full">Geral</div>
									</div>
									<p class="text-sm text-gray-600 dark:text-gray-400 mb-2">Palpites baseados nas configurações gerais, utilizando combinações não sorteadas.</p>
									<div class="flex items-center">
										<label class="mr-2">Quantidade:</label>
										<input type="number" id="configMixBets" min="0" value="1" class="p-1 border rounded w-16 dark:bg-gray-700 dark:border-gray-600 text-base">
									</div>
								</div>
								
								<div class="mixer-card">
									<div class="flex justify-between items-center mb-2">
										<h4 class="font-medium">Seção Palpites Gerados</h4>
										<div class="text-xs px-2 py-1 bg-gray-200 dark:bg-gray-700 rounded-full">Geral</div>
									</div>
									<p class="text-sm text-gray-600 dark:text-gray-400 mb-2">Palpites já gerados anteriormente na seção de Palpites Gerados.</p>
									<div class="flex items-center">
										<label class="mr-2">Quantidade:</label>
										<input type="number" id="generatedMixBets" min="0" value="5" class="p-1 border rounded w-16 dark:bg-gray-700 dark:border-gray-600 text-base">
									</div>
								</div>
								
								<div class="mixer-card">
									<div class="flex justify-between items-center mb-2">
										<h4 class="font-medium">Padrões de Dígitos</h4>
										<div class="text-xs px-2 py-1 bg-indigo-100 dark:bg-indigo-900 text-indigo-800 dark:text-indigo-200 rounded-full">Estatístico</div>
									</div>
									<p class="text-sm text-gray-600 dark:text-gray-400 mb-2">Palpites baseados nos padrões de dígitos mais frequentes nos sorteios anteriores.</p>
									<div class="flex items-center">
										<label class="mr-2">Quantidade:</label>
										<input type="number" id="patternMixBets" min="0" value="5" class="p-1 border rounded w-16 dark:bg-gray-700 dark:border-gray-600 text-base">
									</div>
								</div>
								
								<div class="mixer-card">
									<div class="flex justify-between items-center mb-2">
										<h4 class="font-medium">Combinação Específica</h4>
										<div class="text-xs px-2 py-1 bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200 rounded-full">Dirigido</div>
									</div>
									<p class="text-sm text-gray-600 dark:text-gray-400 mb-2">Palpites baseados na combinação específica de dígitos selecionada.</p>
									<div class="flex items-center">
										<label class="mr-2">Quantidade:</label>
										<input type="number" id="specificMixBets" min="0" value="9" class="p-1 border rounded w-16 dark:bg-gray-700 dark:border-gray-600 text-base">
									</div>
								</div>
							</div>
							
							<div class="mt-4 p-3 bg-yellow-50 dark:bg-yellow-900 rounded-lg text-yellow-800 dark:text-yellow-200 text-sm">
								<p>Os totais da distribuição são ajustados automaticamente para atingir o número total desejado de palpites.</p>
							</div>
						</div>
					</div>
					
					<div class="flex gap-2 mt-6 mb-4">
						<button id="generateMixedBtn" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded">
							Gerar Palpites Misturados
						</button>
					</div>
					
					<div id="mixedBetsContainer" class="mt-5 hidden">
						<div class="flex justify-between items-center mb-4">
							<h3 class="text-lg font-semibold">Palpites Misturados Gerados</h3>
							<div class="flex gap-2">
								<button id="downloadMixedSimpleBtn" class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded flex items-center">
									<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor">
										<path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z" clip-rule="evenodd" />
									</svg>
									Somente Dezenas
								</button>
								<button id="downloadMixedDetailedBtn" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded flex items-center">
									<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor">
										<path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z" clip-rule="evenodd" />
									</svg>
									Baixar Detalhado
								</button>
							</div>
						</div>
						
						<div id="mixedResultsContainer" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
							<!-- Resultados dinâmicos serão mostrados aqui -->
						</div>
					</div>
				</div>
			</div>
		</div>
        <!-- Seção: Palpites Gerados -->
        <div class="mb-8">
            <div class="flex items-center justify-between cursor-pointer mb-2" id="resultsHeader">
                <h2 class="text-xl font-semibold">Palpites Gerados (<span id="totalBetsCount">0</span> palpites)</h2>
                <svg class="h-6 w-6 text-gray-500 dark:text-gray-400 toggle-btn" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                </svg>
            </div>
            <div id="resultsContainer" class="transition-height bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-700 rounded" style="max-height: 500px; overflow: hidden;">
                <div class="p-4">
                    <div class="mb-4 flex flex-wrap gap-2 justify-between items-center">
                        <div class="flex flex-wrap gap-2">
                            <div class="bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200 px-3 py-1 rounded-full text-sm font-medium">
                                Baixas (1-10): <span id="lowCount">0</span>
                            </div>
                            <div class="bg-yellow-100 dark:bg-yellow-900 text-yellow-800 dark:text-yellow-200 px-3 py-1 rounded-full text-sm font-medium">
                                Médias (11-20): <span id="mediumCount">0</span>
                            </div>
                            <div class="bg-red-100 dark:bg-red-900 text-red-800 dark:text-red-200 px-3 py-1 rounded-full text-sm font-medium">
                                Altas (21-31): <span id="highCount">0</span>
                            </div>
                        </div>
                        <div class="flex gap-2">
                            <button id="downloadSimpleBtn" class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded flex items-center">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor">
                                    <path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z" clip-rule="evenodd" />
                                </svg>
                                Somente Dezenas
                            </button>
                            <button id="downloadBtn" class="bg-primary hover:bg-primary/90 text-white font-bold py-2 px-4 rounded flex items-center">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor">
                                    <path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z" clip-rule="evenodd" />
                                </svg>
                                Baixar Detalhado
                            </button>
                        </div>
                    </div>
                    
                    <div class="mb-4">
                        <div class="flex border-b dark:border-gray-700">
                            <button id="allBetsTab" class="py-2 px-4 font-medium border-b-2 border-primary text-primary">Todos</button>
                            <button id="lowBetsTab" class="py-2 px-4 font-medium text-gray-600 dark:text-gray-400">Baixas</button>
                            <button id="mediumBetsTab" class="py-2 px-4 font-medium text-gray-600 dark:text-gray-400">Médias</button>
                            <button id="highBetsTab" class="py-2 px-4 font-medium text-gray-600 dark:text-gray-400">Altas</button>
                        </div>
                    </div>
                    
                    <div id="bettingResults" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                        <!-- Dynamic content will be inserted here -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Adicione este código no início da função DOMContentLoaded
            // Implementação do objeto LOCAL_CACHE para armazenar e recuperar dados em cache
            const LOCAL_CACHE = {
                setCached: function(key, value, expiryMinutes) {
                    try {
                        const now = new Date();
                        // Calcular a data de expiração (minutos a partir de agora)
                        const expiryTime = now.getTime() + expiryMinutes * 60 * 1000;
                        
                        const cacheItem = {
                            value: value,
                            expiry: expiryTime
                        };
                        
                        localStorage.setItem(`cache_${key}`, JSON.stringify(cacheItem));
                        return true;
                    } catch (error) {
                        console.error("Erro ao salvar no cache:", error);
                        return false;
                    }
                },
                
                getCached: function(key) {
                    try {
                        const cachedItem = localStorage.getItem(`cache_${key}`);
                        
                        if (!cachedItem) {
                            return null;
                        }
                        
                        const item = JSON.parse(cachedItem);
                        const now = new Date();
                        
                        // Verificar se o item expirou
                        if (now.getTime() > item.expiry) {
                            // Item expirado, remover do cache
                            localStorage.removeItem(`cache_${key}`);
                            return null;
                        }
                        
                        return item.value;
                    } catch (error) {
                        console.error("Erro ao ler do cache:", error);
                        return null;
                    }
                },
                
                clearCache: function() {
                    // Limpar todos os itens que começam com 'cache_'
                    try {
                        Object.keys(localStorage).forEach(key => {
                            if (key.startsWith('cache_')) {
                                localStorage.removeItem(key);
                            }
                        });
                        return true;
                    } catch (error) {
                        console.error("Erro ao limpar cache:", error);
                        return false;
                    }
                }
            };
            
            // Modal functions
            const modal = document.getElementById('instructionsModal');
            const showModalBtn = document.getElementById('showInstructionsBtn');
            const closeModalBtn = document.getElementById('closeModalBtn');
            const closeModalX = document.getElementById('closeModal');
			const mixerSection = setupCollapsibleSection('mixerHeader', 'mixerContainer', false); // Nova seção do misturador
            
            // Show modal
            showModalBtn.addEventListener('click', function() {
                modal.style.display = 'block';
                document.body.style.overflow = 'hidden'; // Prevent scrolling behind modal
            });
            
            // Close modal with button
            closeModalBtn.addEventListener('click', function() {
                modal.style.display = 'none';
                document.body.style.overflow = 'auto'; // Re-enable scrolling
            });
            
            // Close modal with X
            closeModalX.addEventListener('click', function() {
                modal.style.display = 'none';
                document.body.style.overflow = 'auto'; // Re-enable scrolling
            });
            
            // Close modal when clicking outside
            window.addEventListener('click', function(event) {
                if (event.target === modal) {
                    modal.style.display = 'none';
                    document.body.style.overflow = 'auto'; // Re-enable scrolling
                }
            });
            
            // Configuração para todas as seções expansíveis
            function setupCollapsibleSection(headerId, containerId, initiallyExpanded = false) {
                const header = document.getElementById(headerId);
                const container = document.getElementById(containerId);
                const toggleBtn = header.querySelector('.toggle-btn');
                
                // Remover a transição temporariamente para configuração inicial
                container.style.transition = 'none';
                
                // Estado inicial
                if (!initiallyExpanded) {
                    container.style.maxHeight = '0px';
                    container.style.overflow = 'hidden';
                } else {
                    container.style.maxHeight = '5000px'; // Valor bem grande para acomodar conteúdo
                    toggleBtn.classList.add('active');
                }
                
                // Forçar reflow e restaurar transição
                container.offsetHeight; 
                container.style.transition = 'max-height 0.5s ease-out';
                
                // Adicionar evento de clique
                header.addEventListener('click', function() {
                    // Alternar classe active no botão
                    toggleBtn.classList.toggle('active');
                    
                    if (container.style.maxHeight === '0px') {
                        // Abrir a seção
                        container.style.maxHeight = '5000px'; // Valor grande suficiente para qualquer conteúdo
                        console.log(`Abrindo ${headerId}`);
                    } else {
                        // Fechar a seção
                        container.style.maxHeight = '0px';
                        console.log(`Fechando ${headerId}`);
                    }
                });
                
                // Métodos para manipular a seção
                return {
                    updateHeight: function() {
                        if (container.style.maxHeight !== '0px') {
                            // Redefinir altura para acomodar conteúdo novo
                            container.style.maxHeight = '5000px';
                            console.log(`Atualizando altura de ${headerId}`);
                        }
                    },
                    forceOpen: function() {
                        toggleBtn.classList.add('active');
                        container.style.maxHeight = '5000px';
                        console.log(`Forçando abertura de ${headerId}`);
                    },
                    forceClose: function() {
                        toggleBtn.classList.remove('active');
                        container.style.maxHeight = '0px';
                        console.log(`Forçando fechamento de ${headerId}`);
                    }
                };
            }
            
            // Configurar todas as seções expansíveis
            const digitCombinationsSection = setupCollapsibleSection('digitCombinationsHeader', 'digitCombinationsContainer', false);
            const configSection = setupCollapsibleSection('configHeader', 'configContainer', true);
            const frequencySection = setupCollapsibleSection('frequencyHeader', 'frequencyContainer', true);
            const combinationsSection = setupCollapsibleSection('combinationsToggleHeader', 'combinationsTableContainer', false);
            const statsSection = setupCollapsibleSection('statsHeader', 'statsContainer', false);
            const specificSection = setupCollapsibleSection('specificHeader', 'specificContainer', false);
            const resultsSection = setupCollapsibleSection('resultsHeader', 'resultsContainer', true);
            
            // Corrigir o problema das seções que não abrem, forçando a inicialização
            setTimeout(() => {
                document.querySelectorAll('.transition-height').forEach(el => {
                    // Preservar o estado atual
                    const wasHidden = el.style.maxHeight === '0px';
                    
                    // Forçar a recalcular corretamente as alturas
                    if (wasHidden) {
                        el.style.maxHeight = 'auto';
                        const autoHeight = el.scrollHeight + 'px';
                        el.style.maxHeight = '0px';
                        
                        // Armazenar a altura real para uso posterior
                        el.dataset.fullHeight = autoHeight;
                    } else {
                        el.style.maxHeight = el.scrollHeight + 'px';
                    }
                });
            }, 500);
            
            // Função para gerenciar a distribuição por faixa
            function setupRangeDistribution() {
                const numberPerBetInput = document.getElementById('numberPerBet');
                const lowRangeInput = document.getElementById('lowRange');
                const mediumRangeInput = document.getElementById('mediumRange');
                const highRangeInput = document.getElementById('highRange');
                
                // Variável para armazenar o último campo modificado
                let lastModified = null;
                
                // Função para ajustar os valores mantendo a soma igual ao total
                function adjustValues(changedInput) {
                    // Armazenar o último campo alterado
                    lastModified = changedInput;
                    
                    const targetTotal = parseInt(numberPerBetInput.value);
                    
                    // Limitar os valores aos limites permitidos (0 a targetTotal)
                    let lowVal = Math.max(0, Math.min(targetTotal, parseInt(lowRangeInput.value) || 0));
                    let mediumVal = Math.max(0, Math.min(targetTotal, parseInt(mediumRangeInput.value) || 0));
                    let highVal = Math.max(0, Math.min(targetTotal, parseInt(highRangeInput.value) || 0));
                    
                    // Atualizar os valores nos campos se foram corrigidos
                    lowRangeInput.value = lowVal;
                    mediumRangeInput.value = mediumVal;
                    highRangeInput.value = highVal;
                    
                    const currentTotal = lowVal + mediumVal + highVal;
                    
                    // Se o total já está correto, não precisa ajustar
                    if (currentTotal === targetTotal) {
                        updateDistributionSummary();
                        return;
                    }
                    
                    // Aqui iria o código completo de ajuste que foi omitido por brevidade
                    // Esse código ajusta automaticamente os valores para que somem o total desejado

                    // Atualizar a descrição na interface
                    updateDistributionSummary();
                }
                
                // Função para mostrar um resumo da distribuição atual
                function updateDistributionSummary() {
                    const totalDezenas = parseInt(numberPerBetInput.value);
                    const lowVal = parseInt(lowRangeInput.value) || 0;
                    const mediumVal = parseInt(mediumRangeInput.value) || 0;
                    const highVal = parseInt(highRangeInput.value) || 0;
                    
                    const distributionSummary = document.getElementById('distributionSummary');
                    if (distributionSummary) {
                        distributionSummary.textContent = `Total: ${lowVal + mediumVal + highVal}/${totalDezenas} dezenas`;
                        
                        // Destacar se a soma não estiver correta (não deve acontecer com o auto-ajuste)
                        if (lowVal + mediumVal + highVal !== totalDezenas) {
                            distributionSummary.classList.add('text-red-500');
                        } else {
                            distributionSummary.classList.remove('text-red-500');
                        }
                    }
                }
                
                // Adicionar event listeners
                lowRangeInput.addEventListener('change', () => adjustValues(lowRangeInput));
                mediumRangeInput.addEventListener('change', () => adjustValues(mediumRangeInput));
                highRangeInput.addEventListener('change', () => adjustValues(highRangeInput));
                numberPerBetInput.addEventListener('change', () => adjustValues(numberPerBetInput));
                
                // Também ajustar quando o usuário digita
                lowRangeInput.addEventListener('input', () => adjustValues(lowRangeInput));
                mediumRangeInput.addEventListener('input', () => adjustValues(mediumRangeInput));
                highRangeInput.addEventListener('input', () => adjustValues(highRangeInput));
                
                // Inicializar o resumo da distribuição
                updateDistributionSummary();
            }
            
            // Inicializar a função de distribuição
            setupRangeDistribution();

            // Função para atualizar o indicador visual de tempo de cache
            function updateCacheTimer(expiryTime) {
                const timerElement = document.getElementById('cacheTimerIndicator');
                const cacheIndicator = document.getElementById('cacheIndicator');
                
                if (!timerElement || !cacheIndicator) return;
                
                // Mostrar o indicador de cache
                cacheIndicator.classList.remove('hidden');
                
                function updateRemainingTime() {
                    const now = new Date().getTime();
                    const remaining = expiryTime - now;
                    
                    if (remaining <= 0) {
                        timerElement.textContent = "Cache expirado";
                        return;
                    }
                    
                    // Calcular minutos e segundos restantes
                    const minutes = Math.floor(remaining / 60000);
                    const seconds = Math.floor((remaining % 60000) / 1000);
                    
                    timerElement.textContent = `Atualização em: ${minutes}m ${seconds}s`;
                    
                    // Continuar atualizando a cada segundo
                    setTimeout(updateRemainingTime, 1000);
                }
                
                // Iniciar o temporizador
                updateRemainingTime();
            }
            
            // Função melhorada para buscar resultados da Caixa com melhor feedback visual
            async function fetchResultsFromAPIs() {
                const spinner = document.getElementById('loadingSpinner');
                const fetchText = document.getElementById('fetchText');
                const apiStatus = document.getElementById('apiStatus');
                const apiStatusContent = document.getElementById('apiStatusContent');
                const progressBar = document.getElementById('progressBar');
                const progressText = document.getElementById('progressText');
                const requestLog = document.getElementById('requestLog');
                const cacheIndicator = document.getElementById('cacheIndicator');
                
                // Esconder o indicador de cache
                cacheIndicator.classList.add('hidden');
                
                // Mostrar spinner de carregamento
                spinner.classList.remove('hidden');
                fetchText.textContent = 'Buscando...';
                
                // Mostrar o status da API
                apiStatus.classList.remove('hidden');
                apiStatusContent.innerHTML = '<span class="pulse">Iniciando busca de resultados da API oficial da Caixa...</span>';
                progressBar.style.width = '0%';
                progressText.textContent = '0%';
                
                // Limpar o log anterior
                requestLog.innerHTML = '';
                
                // Limpar qualquer resultado anterior
                document.getElementById('historicalResults').value = '';
                
                // Função para adicionar mensagem ao log com timestamp
                function logMessage(message, isError = false) {
                    const timestamp = new Date().toLocaleTimeString();
                    const logItem = document.createElement('div');
                    logItem.className = isError ? 'text-red-500' : 'text-gray-600 dark:text-gray-400';
                    logItem.textContent = `[${timestamp}] ${message}`;
                    requestLog.prepend(logItem);
                    console.log(`[${timestamp}] ${message}`);
                }
                
                // Função para atualizar o progresso
                function updateProgress(percent, message) {
                    progressBar.style.width = `${percent}%`;
                    progressText.textContent = `${percent}%`;
                    
                    if (message) {
                        apiStatusContent.innerHTML = message;
                    }
                }
                
                // Verificar cache - se existir e for válido, usar dados em cache
                const cacheKey = 'DIA_DE_SORTE_RESULTS';
                const cachedData = LOCAL_CACHE.getCached(cacheKey);
                
                if (cachedData) {
                    logMessage('Usando dados em cache...');
                    updateProgress(100, '<span class="text-green-500">Usando dados em cache.</span>');
                    
                    // Preencher o textarea com os dados em cache
                    document.getElementById('historicalResults').value = cachedData;
                    
                    // Mostrar o indicador de cache e iniciar o temporizador
                    const cacheItem = JSON.parse(localStorage.getItem(`cache_${cacheKey}`));
                    if (cacheItem && cacheItem.expiry) {
                        updateCacheTimer(cacheItem.expiry);
                    }
                    
                    // Esconder o spinner
                    spinner.classList.add('hidden');
                    fetchText.textContent = 'Buscar Resultados';
                    
                    return;
                }
                
                try {
                    // Lista de proxies CORS para tentar
                    const CORS_PROXIES = [
                        'https://corsproxy.io/?',
                        'https://api.allorigins.win/raw?url=',
                        'https://cors-anywhere.herokuapp.com/',
                        'https://thingproxy.freeboard.io/fetch/',
                        'https://proxy.cors.sh/'
                    ];
                    
                    // Função para tentar acessar a API via proxies CORS
                    async function fetchViaCorsProxy(url) {
                        logMessage(`Tentando acessar: ${url}`);
                        
                        // Primeiro tenta acessar diretamente (pode funcionar em alguns ambientes)
                        try {
                            const directResponse = await fetch(url, {
                                method: 'GET',
                                headers: {
                                    'Accept': 'application/json'
                                },
                                mode: 'cors'
                            });
                            
                            if (directResponse.ok) {
                                logMessage('Acesso direto bem-sucedido!');
                                return await directResponse.json();
                            }
                        } catch (directError) {
                            logMessage('Acesso direto falhou, tentando via proxies...', true);
                        }
                        
                        // Se falhar, tenta cada proxy disponível
                        for (const proxyUrl of CORS_PROXIES) {
                            try {
                                const fullUrl = proxyUrl.includes('?url=') ? 
                                    `${proxyUrl}${encodeURIComponent(url)}` : 
                                    `${proxyUrl}${url}`;
                                
                                logMessage(`Tentando via proxy: ${proxyUrl}`);
                                
                                const response = await fetch(fullUrl, {
                                    method: 'GET',
                                    headers: {
                                        'Accept': 'application/json'
                                    },
                                    mode: 'cors',
                                    // Aumentar o timeout para dar tempo suficiente
                                    timeout: 15000
                                });
                                
                                if (response.ok) {
                                    logMessage(`Proxy ${proxyUrl} bem-sucedido!`);
                                    return await response.json();
                                }
                            } catch (proxyError) {
                                logMessage(`Proxy ${proxyUrl} falhou: ${proxyError.message}`, true);
                            }
                        }
                        
                        // Se todos os proxies falharem, lance um erro
                        throw new Error('Todos os métodos de acesso falharam. Verifique sua conexão ou tente mais tarde.');
                    }
                    
                    // Conversor de meses
                    const MONTH_NAME_TO_ABBREV = {
                        'JANEIRO': 'Jan',
                        'FEVEREIRO': 'Fev',
                        'MARÇO': 'Mar', 
                        'MARCO': 'Mar',
                        'ABRIL': 'Abr',
                        'MAIO': 'Mai',
                        'JUNHO': 'Jun',
                        'JULHO': 'Jul',
                        'AGOSTO': 'Ago',
                        'SETEMBRO': 'Set',
                        'OUTUBRO': 'Out',
                        'NOVEMBRO': 'Nov',
                        'DEZEMBRO': 'Dez'
                    };
                    
                    // Função para converter o mês
                    function convertMonthToAbbrev(monthName) {
                        if (!monthName) return '';
                        const upperMonth = monthName.toUpperCase();
                        return MONTH_NAME_TO_ABBREV[upperMonth] || monthName;
                    }
                    
                    // URL base da API da Caixa
                    const CAIXA_API_BASE_URL = 'https://servicebus2.caixa.gov.br/portaldeloterias/api/diadesorte';
                    
                    // Etapa 1: Obter o último concurso
                    updateProgress(5, 'Obtendo informações do último concurso...');
                    
                    let latestData = null;
                    try {
                        latestData = await fetchViaCorsProxy(CAIXA_API_BASE_URL);
                        
                        if (!latestData || !latestData.numero) {
                            throw new Error('Não foi possível obter o número do último concurso');
                        }
                        
                        logMessage(`Último concurso obtido: #${latestData.numero}`);
                        updateProgress(10, `Último concurso: #${latestData.numero}. Preparando para buscar todos os concursos...`);
                    } catch (e) {
                        logMessage(`Erro ao obter o último concurso: ${e.message}`, true);
                        updateProgress(10, `<span class="text-yellow-500">Erro ao obter o último concurso. Tentando alternativa...</span>`);
                        
                        // Se falhou, tenta estimar o último concurso
                        const currentYear = new Date().getFullYear();
                        const yearsSince2018 = currentYear - 2018;
                        const estimatedContests = 105 * (yearsSince2018 + 1); // +1 para incluir 2018
                        
                        latestData = { numero: estimatedContests };
                        logMessage(`Usando valor estimado para último concurso: ${estimatedContests}`, true);
                    }
                    
                    const latestContest = parseInt(latestData.numero);
                    
                    // Etapa 2: Buscar todos os concursos do 1 ao mais recente
                    const allResults = [];
                    const batchSize = 5; // Tamanho reduzido do lote para garantir resposta
                    const totalContests = latestContest;
                    const totalBatches = Math.ceil(totalContests / batchSize);
                    
                    updateProgress(15, `Busca em lotes iniciada. Total de ${totalContests} concursos para buscar...`);
                    
                    // Adicionar o último concurso, já que temos ele
                    if (latestData.listaDezenas && latestData.listaDezenas.length > 0) {
                        const monthAbbrev = convertMonthToAbbrev(latestData.nomeTimeCoracaoMesSorte || '');
                        
                        allResults.push({
                            concurso: latestContest,
                            dezenas: latestData.listaDezenas.map(n => parseInt(n)),
                            mesDaSorte: monthAbbrev
                        });
                        
                        logMessage(`Adicionado concurso #${latestContest} à lista de resultados`);
                    }
                    
                    // Dados de exemplo mínimos caso todas as tentativas falhem
                    const FALLBACK_DATA = [
                        "01 03 07 13 18 27 29 Jan",
                        "04 07 09 10 14 20 25 Fev",
                        "03 06 07 11 18 26 29 Mar",
                        "05 08 09 17 22 23 30 Abr",
                        "02 05 09 12 16 24 30 Mai",
                        "10 11 12 14 19 21 22 Jun"
                    ];
                    
                    // Buscar todos os concursos em lotes, mas de forma mais resiliente
                    for (let batchNum = 0; batchNum < totalBatches; batchNum++) {
                        try {
                            const startContest = batchNum * batchSize + 1;
                            const endContest = Math.min((batchNum + 1) * batchSize, totalContests);
                            
                            // Se já temos o último concurso e este lote inclui apenas o último, pule
                            if (startContest === totalContests && allResults.some(r => r.concurso === totalContests)) {
                                continue;
                            }
                            
                            const progress = Math.round(15 + (75 * batchNum / totalBatches));
                            updateProgress(progress, `Buscando lote ${batchNum + 1}/${totalBatches} (concursos ${startContest} a ${endContest})...`);
                            
                            // Buscar cada concurso no lote com timeout para não ficar preso
                            const batchPromises = [];
                            
                            for (let concurso = startContest; concurso <= endContest; concurso++) {
                                // Pular concursos que já temos
                                if (allResults.some(r => r.concurso === concurso)) {
                                    continue;
                                }
                                
                                // Usar Promise.race com timeout para evitar que a busca fique presa
                                const timeoutPromise = new Promise((_, reject) => 
                                    setTimeout(() => reject(new Error(`Timeout buscando concurso #${concurso}`)), 10000)
                                );
                                
                                batchPromises.push(
                                    Promise.race([
                                        (async () => {
                                            try {
                                                const url = `${CAIXA_API_BASE_URL}/${concurso}`;
                                                const data = await fetchViaCorsProxy(url);
                                                
                                                if (data && data.numero && data.listaDezenas && data.listaDezenas.length > 0) {
                                                    const monthAbbrev = convertMonthToAbbrev(data.nomeTimeCoracaoMesSorte || '');
                                                    
                                                    return {
                                                        concurso: parseInt(data.numero),
                                                        dezenas: data.listaDezenas.map(n => parseInt(n)),
                                                        mesDaSorte: monthAbbrev
                                                    };
                                                }
                                                return null;
                                            } catch (e) {
                                                logMessage(`Erro buscando concurso #${concurso}: ${e.message}`, true);
                                                return null;
                                            }
                                        })(),
                                        timeoutPromise
                                    ]).catch(() => null) // Garantir que falhas não parem todo o processo
                                );
                            }
                            
                            // Usar Promise.allSettled para não parar se algum falhar
                            const batchResults = await Promise.allSettled(batchPromises);
                            
                            // Filtrar apenas os resultados bem-sucedidos
                            const validResults = batchResults
                                .filter(result => result.status === 'fulfilled' && result.value)
                                .map(result => result.value);
                            
                            // Adicionar à lista de resultados
                            allResults.push(...validResults);
                            
                            // Atualizar o progresso
                            updateProgress(progress, `Obtidos ${allResults.length} de ${totalContests} concursos (${Math.round(allResults.length/totalContests*100)}%)...`);
                            logMessage(`Obtidos ${validResults.length} concursos neste lote. Total até agora: ${allResults.length}`);
                            
                            // Se poucas ou nenhuma resposta no lote, parar para não desperdiçar tempo
                            if (validResults.length === 0 && batchNum > 3) {
                                logMessage(`Muitas falhas consecutivas. Parando a busca para usar os dados obtidos até agora.`, true);
                                break;
                            }
                            
                            // Pequena pausa entre lotes para não sobrecarregar
                            await new Promise(resolve => setTimeout(resolve, 300));
                        } catch (batchError) {
                            logMessage(`Erro ao processar lote ${batchNum + 1}: ${batchError.message}`, true);
                            
                            // Continuar com o próximo lote mesmo em caso de erro
                            continue;
                        }
                    }
                    
                    // Se não conseguiu obter nenhum resultado, usar dados de fallback
                    if (allResults.length === 0) {
                        logMessage(`Não foi possível obter resultados. Usando dados mínimos de exemplo.`, true);
                        updateProgress(95, `<span class="text-yellow-500">Impossível conectar à API da Caixa. Usando dados mínimos de exemplo.</span>`);
                        
                        // Usar dados mínimos de exemplo
                        document.getElementById('historicalResults').value = FALLBACK_DATA.join('\n');
                        
                        // Esconder o spinner
                        spinner.classList.add('hidden');
                        fetchText.textContent = 'Buscar Resultados';
                        
                        // Salvar no cache com validade menor
                        LOCAL_CACHE.setCached(cacheKey, FALLBACK_DATA.join('\n'), 1 * 60); // 1 hora
                        updateCacheTimer(new Date().getTime() + 1 * 60 * 60 * 1000);
                        
                        return;
                    }
                    
                    // Ordenar resultados por número do concurso
                    allResults.sort((a, b) => a.concurso - b.concurso);
                    
                    // Verificar se temos resultados suficientes
                    if (allResults.length < totalContests * 0.5) {
                        logMessage(`Alerta: Obtidos apenas ${allResults.length} de ${totalContests} concursos (${Math.round(allResults.length/totalContests*100)}%)`, true);
                        updateProgress(95, `<span class="text-yellow-500">Atenção: Obtidos apenas ${Math.round(allResults.length/totalContests*100)}% dos concursos. Os dados estão incompletos.</span>`);
                    } else {
                        updateProgress(95, `Finalizando processamento de ${allResults.length} concursos...`);
                    }
                    
                    // Formatar os resultados no formato esperado pela aplicação
                    const formattedResults = allResults.map(result => {
                        // Formatar as dezenas com zero à esquerda
                        const formattedDezenas = result.dezenas.map(num => {
                            return num < 10 ? `0${num}` : `${num}`;
                        });
                        
                        // Garantir que o mês da sorte seja exibido com espaçamento correto
                        // Se o mês estiver disponível, adicione dois espaços antes dele para melhor formatação
                        const monthStr = result.mesDaSorte ? `  ${result.mesDaSorte}` : '';
                        
                        return `${formattedDezenas.join(' ')}${monthStr}`;
                    }).join('\n');
                    
                    // Atualizar a interface
                    document.getElementById('historicalResults').value = formattedResults;
                    
                    // Salvar no cache local (válido por 5 horas)
                    const cacheExpiry = 5 * 60; // 5 horas em minutos
                    LOCAL_CACHE.setCached(cacheKey, formattedResults, cacheExpiry);
                    updateCacheTimer(new Date().getTime() + cacheExpiry * 60 * 1000);
                    
                    updateProgress(100, `<span class="text-green-500">Sucesso! Obtidos ${allResults.length} concursos do Dia de Sorte.</span>`);
                    
                } catch (error) {
                    logMessage(`Erro geral: ${error.message}`, true);
                    updateProgress(100, `<span class="text-red-500">Erro: ${error.message}</span>`);
                } finally {
                    // Garantir que o spinner seja escondido em qualquer circunstância
                    spinner.classList.add('hidden');
                    fetchText.textContent = 'Buscar Resultados';
                }
            }

		// Configurar botão para buscar resultados
		document.getElementById('fetchResultsBtn').addEventListener('click', fetchResultsFromAPIs);

function analyzeFrequency() {
    // Verificar e inicializar variáveis globais se necessário
    if (typeof numberFrequency === 'undefined') {
        window.numberFrequency = {};
        for (let i = 1; i <= 31; i++) {
            numberFrequency[i] = 0;
        }
    }
    
    if (typeof monthFrequency === 'undefined') {
        window.monthFrequency = {
            'Jan': 0, 'Fev': 0, 'Mar': 0, 'Abr': 0, 'Mai': 0, 'Jun': 0,
            'Jul': 0, 'Ago': 0, 'Set': 0, 'Out': 0, 'Nov': 0, 'Dez': 0
        };
    }
    
    if (typeof startDigitFrequency === 'undefined') {
        window.startDigitFrequency = {};
    }
    
    if (typeof endDigitFrequency === 'undefined') {
        window.endDigitFrequency = {};
    }
    
    if (typeof patternFrequency === 'undefined') {
        window.patternFrequency = [];
    }
    
    if (typeof drawnCombinations === 'undefined') {
        window.drawnCombinations = {};
    }
    
    if (typeof undrawnCombinations === 'undefined') {
        window.undrawnCombinations = [];
    }
    
    if (typeof numberCategoryStats === 'undefined') {
        window.numberCategoryStats = {
            low: { count: 0, percentage: 0 },
            medium: { count: 0, percentage: 0 },
            high: { count: 0, percentage: 0 },
            total: 0
        };
    }

    const resultsText = document.getElementById('historicalResults').value.trim();
    if (!resultsText) {
        alert('Por favor, insira os resultados históricos.');
        return;
    }

    const results = [];
    const lines = resultsText.split('\n');
    
    // Reset statistics
    numberCategoryStats = {
        low: { count: 0, percentage: 0 },
        medium: { count: 0, percentage: 0 },
        high: { count: 0, percentage: 0 },
        total: 0
    };
    
    // Reset number frequency
    for (let i = 1; i <= 31; i++) {
        numberFrequency[i] = 0;
    }
    
    // Reset month frequency
    for (const month in monthFrequency) {
        monthFrequency[month] = 0;
    }
    
    // Reset pattern frequency
    startDigitFrequency = {};
    endDigitFrequency = {};
    patternFrequency = [];

    // Parse each line of results
    for (const line of lines) {
        if (line.trim() === '') continue;
        
        // Split the line into words
        const parts = line.trim().split(/\s+/);
        
        // Check if the last part might be a month
        let numbers = [];
        let month = null;
        
        // If we have at least 7 numbers
        if (parts.length >= 7) {
            // Try to parse the last item as a month
            if (parts.length > 7) {
                const lastPart = parts[parts.length - 1];
                month = parseMonth(lastPart);
                
                if (month) {
                    // Se for um mês, excluir da lista de números e processar os números
                    const numberParts = parts.slice(0, -1);
                    numbers = processNumberParts(numberParts);
                } else {
                    // Se não for um mês, processar todos como números
                    numbers = processNumberParts(parts);
                }
            } else {
                // Exatamente 7 partes, assumir que todos são números
                numbers = processNumberParts(parts);
            }
            
            // Incrementar a frequência do mês, se um mês foi encontrado
            if (month) {
                monthFrequency[month]++;
            }
            
            // Só processar resultados com pelo menos 7 números válidos
            if (numbers.length >= 7) {
                // Garantir apenas os primeiros 7 números
                const validNumbers = numbers.slice(0, 7);
                
                results.push({
                    numbers: validNumbers,
                    month: month
                });
                
                // Contar números por categoria para estatísticas
                validNumbers.forEach(num => {
                    if (num >= 1 && num <= 31) { // Garantir apenas números válidos
                        numberCategoryStats.total++;
                        
                        // Incrementar a frequência para este número específico
                        numberFrequency[num] = (numberFrequency[num] || 0) + 1;
                        
                        if (num <= 10) {
                            numberCategoryStats.low.count++;
                        } else if (num <= 20) {
                            numberCategoryStats.medium.count++;
                        } else {
                            numberCategoryStats.high.count++;
                        }
                    }
                });
            }
        }
    }
    
    if (results.length === 0) {
        alert('Nenhum resultado válido encontrado. Verifique o formato.');
        return;
    }
    
    // Analisar padrões de dígitos
    analyzeDigitPatterns(results);
    
    // Renderizar estatísticas
    renderNumberCategoryChart();
    renderNumberFrequencyGrid();
    renderMonthFrequency();
    
    // Count digit occurrences in each result
    const digitCombinationCounts = {};
    
    // Inicializar contadores para todas as combinações possíveis
    validDigitCombinations.forEach(combo => {
        digitCombinationCounts[combo] = 0;
    });
    
    // Iterate through each result
    results.forEach(result => {
        // Get all digits from all numbers in this result
        const allDigits = new Set();
        result.numbers.forEach(num => {
            getDigits(num).forEach(digit => allDigits.add(digit));
        });
        
        // Convert to array and sort
        const digitsArray = Array.from(allDigits).sort((a, b) => a - b);
        
        // Only consider results with 5 or more distinct digits
        if (digitsArray.length >= 5) {
            // Verificar quais das combinações válidas estão presentes neste resultado
            validDigitCombinations.forEach(combo => {
                const comboDigits = combo.split(',').map(Number);
                
                // Verificar se todos os dígitos da combinação estão presentes
                if (comboDigits.every(digit => digitsArray.includes(digit))) {
                    digitCombinationCounts[combo]++;
                }
            });
        }
    });
    
    // Guardar as frequências para uso posterior
    drawnCombinations = {...digitCombinationCounts};
    
    // Convert to array for sorting
    const combinationsArray = Object.entries(digitCombinationCounts)
        .map(([combo, count]) => ({ combo, count }))
        .sort((a, b) => b.count - a.count);
    
    // Identificar combinações que ainda não foram sorteadas
    undrawnCombinations = validDigitCombinations.filter(combo => 
        digitCombinationCounts[combo] === 0
    );
    
    // Buscar elementos DOM - versão robusta
    // Tenta recuperar por ID primeiro, depois por seletor se necessário
    function getElement(id) {
        let element = document.getElementById(id);
        if (!element) {
            // Tentativa alternativa usando seletores mais específicos
            element = document.querySelector(`#${id}, [id="${id}"], tbody[id="${id}"], div[id="${id}"]`);
        }
        return element;
    }
    
    // Obter todos os elementos necessários
    const undrawnCountDisplay = getElement('undrawnCountDisplay');
    const frequencyResults = getElement('frequencyResults');
    const topCombinations = getElement('topCombinations');
    const undrawnCombinationsContent = getElement('undrawnCombinationsContent');
    const frequencyContainer = getElement('frequencyContainer');
    
    // Busca especial para o frequencyTableBody que está causando problemas
    let frequencyTableBody = getElement('frequencyTableBody');
    if (!frequencyTableBody) {
        // Estratégia de fallback: criar o elemento se ele não existir
        console.log("Elemento frequencyTableBody não encontrado, tentando criar...");
        
        // Verificar se existe uma tabela onde podemos adicionar o tbody
        const table = document.querySelector('table');
        if (table) {
            frequencyTableBody = document.createElement('tbody');
            frequencyTableBody.id = 'frequencyTableBody';
            
            // Verificar se já existe um tbody na tabela
            const existingTbody = table.querySelector('tbody');
            if (existingTbody) {
                // Substituir o tbody existente
                table.replaceChild(frequencyTableBody, existingTbody);
            } else {
                // Adicionar novo tbody
                table.appendChild(frequencyTableBody);
            }
            console.log("Elemento frequencyTableBody criado com sucesso!");
        }
    }
    
    // Atualizar contador de combinações não sorteadas
    if (undrawnCountDisplay) {
        undrawnCountDisplay.textContent = undrawnCombinations.length;
    }
    
    // MANIPULAÇÃO DIRETA DOS ELEMENTOS E ESTILOS
    
    // Garantir que o container de frequência esteja visível e expandido
    if (frequencyContainer) {
        frequencyContainer.style.transition = 'none';
        frequencyContainer.style.maxHeight = '5000px';
        frequencyContainer.style.overflow = 'visible';
        
        // Garantir que o botão de toggle mostre o estado correto (aberto)
        const frequencyToggleBtn = document.querySelector('#frequencyHeader .toggle-btn');
        if (frequencyToggleBtn) {
            frequencyToggleBtn.classList.add('active');
        }
        
        // Restaurar transição após as mudanças
        setTimeout(() => {
            frequencyContainer.style.transition = 'max-height 0.5s ease-out';
        }, 100);
    }
    
    // Forçar todas as seções de estatísticas a serem visíveis
    const sections = [
        'frequencyResults',
        'numberCategoryStats', 
        'numberFrequencyStats',
        'monthFrequencyStats',
        'digitPatternsStats',
        'undrawnCombinations'
    ];
    
    sections.forEach(id => {
        const element = getElement(id);
        if (element) {
            element.style.display = 'block';
            element.style.visibility = 'visible';
            element.style.opacity = '1';
        }
    });
    
    // Tornar as seções visíveis
    if (frequencyResults) {
        frequencyResults.classList.remove('hidden');
    }
    
    if (frequencyTableBody) {
        frequencyTableBody.innerHTML = '';
    }
    
    if (undrawnCombinationsContent) {
        undrawnCombinationsContent.innerHTML = '';
    }
    
    if (combinationsArray.length === 0) {
        if (topCombinations) {
            topCombinations.innerHTML = 'Nenhuma combinação de 5 dígitos encontrada nos resultados.';
        }
        return;
    }
    
    // Show the top combinations with highlighting for 5 digits
    if (topCombinations) {
        const top5Combos = combinationsArray.filter(item => item.count > 0).slice(0, 5);
        
        let topCombosHTML = `
            <div class="font-bold text-xl mb-3 flex items-center">
                Combinações de <span class="mx-1 bg-green-200 dark:bg-green-700 text-green-800 dark:text-green-200 px-2 py-0.5 rounded-full">5</span> Dígitos Mais Frequentes
            </div>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
        `;
        
        top5Combos.forEach((item, index) => {
            const percentage = ((item.count / results.length) * 100).toFixed(1);
            topCombosHTML += `
                <div class="bg-green-100 dark:bg-green-900 p-3 rounded-lg border-2 border-green-500">
                    <div class="font-bold text-lg text-green-800 dark:text-green-200">${index + 1}. ${item.combo}</div>
                    <div class="text-green-700 dark:text-green-300">
                        ${item.count} de ${results.length} resultados (${percentage}%)
                    </div>
                </div>
            `;
        });
        
        topCombosHTML += `</div>`;
        
        // Adicionar informação sobre combinações que ainda não apareceram
        topCombosHTML += `
            <div class="mt-4 p-3 bg-yellow-100 dark:bg-yellow-900 rounded-lg">
                <div class="font-bold text-yellow-800 dark:text-yellow-200">
                    ${undrawnCombinations.length} combinações ainda não apareceram em nenhum sorteio (de um total de ${validDigitCombinations.length})
                </div>
            </div>
        `;
        
        topCombinations.innerHTML = topCombosHTML;
    }
    
    // Mostrar as combinações não sorteadas
    if (undrawnCombinations.length > 0) {
        if (undrawnCombinationsContent) {
            undrawnCombinations.forEach(combo => {
                const comboDiv = document.createElement('div');
                comboDiv.className = 'bg-blue-50 dark:bg-blue-800 p-2 rounded border border-blue-200 dark:border-blue-700';
                comboDiv.innerHTML = `<div class="text-blue-800 dark:text-blue-200 font-medium">${combo}</div>`;
                undrawnCombinationsContent.appendChild(comboDiv);
            });
        }
        
        // Forçar a visibilidade da seção
        const undrawnCombinationsEl = getElement('undrawnCombinations');
        if (undrawnCombinationsEl) {
            undrawnCombinationsEl.style.display = 'block';
        }
        
        // NOVA FUNCIONALIDADE: Preencher a área "Combinações de Dígitos" com apenas as não sorteadas
        const digitCombinations = getElement('digitCombinations');
        if (digitCombinations) {
            digitCombinations.value = undrawnCombinations.join('\n');
        }
        
        // Atualizar a variável global para usar apenas as combinações não sorteadas
        validDigitCombinations = [...undrawnCombinations];
        
        // Atualizar o texto do cabeçalho
        const combinationsHeader = document.querySelector('#digitCombinationsHeader h2');
        if (combinationsHeader) {
            combinationsHeader.innerHTML = `
                <span>Combinações de Dígitos</span> 
                <span class="text-sm font-bold ml-2 bg-blue-100 dark:bg-blue-800 text-blue-800 dark:text-blue-200 px-2 py-0.5 rounded-full">(${undrawnCombinations.length})</span>
            `;
        }
        
        // Limpar quaisquer palpites gerados anteriormente
        const bettingResults = getElement('bettingResults');
        if (bettingResults) {
            bettingResults.innerHTML = '';
        }
        
        const counters = ['totalBetsCount', 'lowCount', 'mediumCount', 'highCount'];
        counters.forEach(counterId => {
            const counter = getElement(counterId);
            if (counter) counter.textContent = '0';
        });
        
        // Expandir a seção de combinações de dígitos diretamente
        const digitContainer = getElement('digitCombinationsContainer');
        if (digitContainer) {
            digitContainer.style.transition = 'none';
            digitContainer.style.maxHeight = '5000px';
            digitContainer.style.overflow = 'visible';
            
            // Garantir que o botão de toggle mostre o estado correto (aberto)
            const digitToggleBtn = document.querySelector('#digitCombinationsHeader .toggle-btn');
            if (digitToggleBtn) {
                digitToggleBtn.classList.add('active');
            }
            
            // Restaurar transição
            setTimeout(() => {
                digitContainer.style.transition = 'max-height 0.5s ease-out';
            }, 100);
        }
    } else {
        const undrawnEl = getElement('undrawnCombinations');
        if (undrawnEl) {
            undrawnEl.style.display = 'none';
        }
    }
    
    // Fill the frequency table with all combinations that appeared
    if (frequencyTableBody) {
        combinationsArray.filter(item => item.count > 0).forEach(({ combo, count }) => {
            const percentage = ((count / results.length) * 100).toFixed(1);
            
            const row = document.createElement('tr');
            
            // Destacar as combinações de 5 dígitos
            row.classList.add('bg-green-100', 'dark:bg-green-800');
            row.innerHTML = `
                <td class="px-2 py-2 font-bold">${combo}</td>
                <td class="px-2 py-2 font-bold">${count} de ${results.length}</td>
                <td class="px-2 py-2 font-bold">${percentage}%</td>
            `;
            
            frequencyTableBody.appendChild(row);
        });
    }
    
    // Atualizar o dropdown para mostrar as frequências nas combinações
    if (typeof updateSpecificComboDropdown === 'function') {
        updateSpecificComboDropdown();
        
        // Disparar evento change para atualizar a exibição
        const specificComboSelect = getElement('specificCombination');
        if (specificComboSelect) {
            specificComboSelect.dispatchEvent(new Event('change'));
        }
    }
    
    // Log de depuração
    console.log("Análise de frequência concluída com sucesso!");
    console.log("Resultados encontrados:", results.length);
    console.log("Combinações não sorteadas:", undrawnCombinations.length);
    
    // IMPORTANTE: Forçar recálculo das alturas depois que todo o conteúdo for carregado
    if (typeof frequencySection !== 'undefined' && frequencySection && typeof frequencySection.updateHeight === 'function') {
        setTimeout(() => {
            frequencySection.updateHeight();
            console.log("Altura da seção de frequência atualizada");
        }, 500);
    }
}



		// Event listener para o botão de limpar cache
		document.getElementById('clearCacheBtn').addEventListener('click', function() {
			if (confirm('Tem certeza que deseja limpar o cache? Isso forçará uma nova busca de resultados da internet.')) {
				LOCAL_CACHE.clearCache();
				document.getElementById('cacheIndicator').classList.add('hidden');
				alert('Cache limpo com sucesso. Clique em "Buscar Resultados" para atualizar os dados.');
			}
		});

		// Event listeners para botões e outros elementos
		document.getElementById('analyzeBtn').addEventListener('click', analyzeFrequency);
		document.getElementById('generateBtn').addEventListener('click', generateResults);
		document.getElementById('printBtn').addEventListener('click', function() {
			window.print();
		});
		// etc...			
			
			
        });
    </script>
    
    <footer>Feito por: <i>Márcio Fernando Maia - Todos os direitos reservado - 2025</i></footer>
</body>
</html>