<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analisador Multi-Dígitos - Dia de Sorte</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#5D5CDE',
                    }
                }
            },
            darkMode: 'class',
        }
    </script>
    <style>
        @media print {
            .no-print {
                display: none;
            }
            .page-break {
                page-break-after: always;
            }
        }
        
        footer {
            color: #161515;
            text-align: center;
            padding: 5px;
            margin-bottom: auto;
            margin-top: 10px;
        }
        
        .number-low {
            background-color: rgba(134, 239, 172, 0.9);
            color: rgb(22, 101, 52);
        }
        
        .dark .number-low {
            background-color: rgba(22, 101, 52, 0.7);
            color: rgb(187, 247, 208);
        }
        
        .number-medium {
            background-color: rgba(253, 230, 138, 0.9);
            color: rgb(146, 64, 14);
        }
        
        .dark .number-medium {
            background-color: rgba(146, 64, 14, 0.7);
            color: rgb(254, 240, 138);
        }
        
        .number-high {
            background-color: rgba(252, 165, 165, 0.9);
            color: rgb(153, 27, 27);
        }
        
        .dark .number-high {
            background-color: rgba(153, 27, 27, 0.7);
            color: rgb(254, 202, 202);
        }
        
        .tab-active {
            border-bottom: 2px solid #5D5CDE;
            color: #5D5CDE;
        }
        
        .tab-inactive {
            color: #6B7280;
            border-bottom: 2px solid transparent;
        }
        
        .dark .tab-inactive {
            color: #9CA3AF;
        }
    </style>
</head>
<body class="bg-white dark:bg-gray-900 text-gray-800 dark:text-gray-200 min-h-screen">
    <!-- Dark mode detection -->
    <script>
        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            document.documentElement.classList.add('dark');
        }
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
            if (event.matches) {
                document.documentElement.classList.add('dark');
            } else {
                document.documentElement.classList.remove('dark');
            }
        });
    </script>

    <div class="container mx-auto px-4 py-8">
        <h1 class="text-3xl font-bold text-center text-primary mb-6">Analisador Multi-Dígitos - Dia de Sorte</h1>
        
        <!-- Selector for digit group size -->
        <div class="mb-8 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-700 rounded-lg p-6 shadow-md">
            <h2 class="text-xl font-semibold mb-4">Selecione o Tamanho do Grupo de Dígitos</h2>
            
            <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-5 lg:grid-cols-10 gap-2 mb-4">
                <button class="digit-size-btn p-3 rounded-lg border-2 border-gray-300 dark:border-gray-600 hover:border-primary dark:hover:border-primary transition-colors" data-size="1">
                    <div class="text-lg font-bold">1 Dígito</div>
                    <div class="text-sm text-gray-500 dark:text-gray-400">10 combinações</div>
                </button>
                <button class="digit-size-btn p-3 rounded-lg border-2 border-gray-300 dark:border-gray-600 hover:border-primary dark:hover:border-primary transition-colors" data-size="2">
                    <div class="text-lg font-bold">2 Dígitos</div>
                    <div class="text-sm text-gray-500 dark:text-gray-400">45 combinações</div>
                </button>
                <button class="digit-size-btn p-3 rounded-lg border-2 border-gray-300 dark:border-gray-600 hover:border-primary dark:hover:border-primary transition-colors" data-size="3">
                    <div class="text-lg font-bold">3 Dígitos</div>
                    <div class="text-sm text-gray-500 dark:text-gray-400">120 combinações</div>
                </button>
                <button class="digit-size-btn p-3 rounded-lg border-2 border-gray-300 dark:border-gray-600 hover:border-primary dark:hover:border-primary transition-colors" data-size="4">
                    <div class="text-lg font-bold">4 Dígitos</div>
                    <div class="text-sm text-gray-500 dark:text-gray-400">210 combinações</div>
                </button>
                <button class="digit-size-btn p-3 rounded-lg border-2 border-primary dark:border-primary bg-primary/10 dark:bg-primary/20" data-size="5">
                    <div class="text-lg font-bold">5 Dígitos</div>
                    <div class="text-sm">252 combinações</div>
                </button>
                <button class="digit-size-btn p-3 rounded-lg border-2 border-gray-300 dark:border-gray-600 hover:border-primary dark:hover:border-primary transition-colors" data-size="6">
                    <div class="text-lg font-bold">6 Dígitos</div>
                    <div class="text-sm text-gray-500 dark:text-gray-400">210 combinações</div>
                </button>
                <button class="digit-size-btn p-3 rounded-lg border-2 border-gray-300 dark:border-gray-600 hover:border-primary dark:hover:border-primary transition-colors" data-size="7">
                    <div class="text-lg font-bold">7 Dígitos</div>
                    <div class="text-sm text-gray-500 dark:text-gray-400">120 combinações</div>
                </button>
                <button class="digit-size-btn p-3 rounded-lg border-2 border-gray-300 dark:border-gray-600 hover:border-primary dark:hover:border-primary transition-colors" data-size="8">
                    <div class="text-lg font-bold">8 Dígitos</div>
                    <div class="text-sm text-gray-500 dark:text-gray-400">45 combinações</div>
                </button>
                <button class="digit-size-btn p-3 rounded-lg border-2 border-gray-300 dark:border-gray-600 hover:border-primary dark:hover:border-primary transition-colors" data-size="9">
                    <div class="text-lg font-bold">9 Dígitos</div>
                    <div class="text-sm text-gray-500 dark:text-gray-400">10 combinações</div>
                </button>
                <button class="digit-size-btn p-3 rounded-lg border-2 border-gray-300 dark:border-gray-600 hover:border-primary dark:hover:border-primary transition-colors" data-size="10">
                    <div class="text-lg font-bold">10 Dígitos</div>
                    <div class="text-sm text-gray-500 dark:text-gray-400">1 combinação</div>
                </button>
            </div>
            
            <div class="bg-blue-50 dark:bg-blue-900 p-4 rounded-lg">
                <div class="flex items-center mb-2">
                    <div class="bg-primary text-white text-xl font-bold rounded-full w-10 h-10 flex items-center justify-center mr-3" id="sizeIndicator">5</div>
                    <h3 class="text-lg font-semibold text-blue-800 dark:text-blue-300">Combinações de <span id="groupSizeText">5</span> Dígitos</h3>
                </div>
                <p class="text-blue-800 dark:text-blue-200">
                    Total: <span id="totalCombinationsText">252</span> combinações possíveis 
                    (<span id="validCombinationsText">126</span> utilizadas para análise)
                </p>
                <p class="text-blue-800 dark:text-blue-200 mt-2" id="sizeDescription">
                    A análise de 5 dígitos é considerada ideal para o jogo Dia de Sorte, pois cada combinação 
                    gera uma quantidade adequada de números possíveis.
                </p>
            </div>
        </div>
        
        <!-- Main tabs -->
        <div class="bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-700 rounded-lg shadow-md mb-8">
            <div class="flex border-b border-gray-300 dark:border-gray-700">
                <button id="combinationsTab" class="tab-active py-3 px-4 font-medium">Combinações</button>
                <button id="analysisTab" class="tab-inactive py-3 px-4 font-medium">Análise</button>
                <button id="betsTab" class="tab-inactive py-3 px-4 font-medium">Palpites</button>
            </div>
            
            <!-- Combinations tab content -->
            <div id="combinationsContent" class="p-4">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-xl font-semibold">Combinações de <span class="group-size-display">5</span> Dígitos</h2>
                    <div class="flex gap-2">
                        <button id="copyAllBtn" class="bg-primary hover:bg-primary/90 text-white text-sm font-medium py-1 px-3 rounded-md flex items-center">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" viewBox="0 0 20 20" fill="currentColor">
                                <path d="M8 2a1 1 0 000 2h2a1 1 0 100-2H8z" />
                                <path d="M3 5a2 2 0 012-2 3 3 0 003 3h2a3 3 0 003-3 2 2 0 012 2v6h-4.586l1.293-1.293a1 1 0 00-1.414-1.414l-3 3a1 1 0 000 1.414l3 3a1 1 0 001.414-1.414L10.414 13H15v3a2 2 0 01-2 2H5a2 2 0 01-2-2V5zM15 11h2a1 1 0 110 2h-2v-2z" />
                            </svg>
                            Copiar Todas
                        </button>
                        <button id="downloadCombinationsBtn" class="bg-green-600 hover:bg-green-700 text-white text-sm font-medium py-1 px-3 rounded-md flex items-center">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z" clip-rule="evenodd" />
                            </svg>
                            Baixar Lista
                        </button>
                    </div>
                </div>
                
                <div class="bg-gray-100 dark:bg-gray-700 p-4 rounded-lg mb-4">
                    <div class="font-medium mb-2">Total: <span id="totalCombinationsCount" class="font-bold">126</span> combinações</div>
                    <div id="combinationsGrid" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-2 max-h-[400px] overflow-y-auto p-2">
                        <!-- Will be filled dynamically -->
                    </div>
                </div>
                
                <div class="bg-yellow-50 dark:bg-yellow-900 p-4 rounded-lg">
                    <h3 class="text-lg font-semibold text-yellow-800 dark:text-yellow-300 mb-2">Gerador de Números Possíveis</h3>
                    
                    <div class="mb-4">
                        <label class="block mb-1 font-medium text-yellow-800 dark:text-yellow-300">Digite uma combinação específica:</label>
                        <div class="flex gap-2">
                            <input type="text" id="specificCombination" placeholder="Ex: 1,3,5,7,9" class="p-2 border rounded w-full dark:bg-gray-700 dark:border-gray-600 text-base">
                            <button id="generateNumbersBtn" class="bg-yellow-600 hover:bg-yellow-700 text-white font-medium py-2 px-4 rounded whitespace-nowrap">
                                Gerar Números
                            </button>
                        </div>
                    </div>
                    
                    <div id="possibleNumbersContainer" class="hidden">
                        <h4 class="font-semibold text-yellow-800 dark:text-yellow-300 mb-2">Números possíveis para a combinação: <span id="selectedCombination"></span></h4>
                        <div id="possibleNumbersGrid" class="flex flex-wrap gap-2 mb-4">
                            <!-- Will be filled dynamically -->
                        </div>
                        <div class="text-sm text-yellow-700 dark:text-yellow-400">
                            Total: <span id="possibleNumbersCount">0</span> números possíveis
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Analysis tab content -->
            <div id="analysisContent" class="p-4 hidden">
                <div class="mb-4">
                    <h2 class="text-xl font-semibold mb-4">Análise de Resultados Anteriores</h2>
                    
                    <div class="mb-4">
                        <label class="block mb-1">Cole os resultados do Dia de Sorte (um por linha, números separados por espaço):</label>
                        <textarea id="historicalResults" rows="6" placeholder="Ex: 01 03 07 13 18 27 29 
04 07 09 10 14 20 25" class="w-full p-2 border rounded dark:bg-gray-800 dark:border-gray-700 text-base"></textarea>
                    </div>
                    
                    <div class="flex flex-wrap gap-2 mb-4">
                        <button id="analyzeBtn" class="bg-primary hover:bg-primary/90 text-white font-bold py-2 px-4 rounded flex items-center">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M3 3a1 1 0 011-1h12a1 1 0 011 1v3a1 1 0 01-.293.707L12 11.414V15a1 1 0 01-.293.707l-2 2A1 1 0 018 17v-5.586L3.293 6.707A1 1 0 013 6V3z" clip-rule="evenodd" />
                            </svg>
                            Analisar Frequência
                        </button>
                        <div class="flex flex-col sm:flex-row gap-2 flex-grow">
                            <select id="apiSelect" class="p-2 border rounded dark:bg-gray-700 dark:border-gray-600 text-base flex-grow">
                                <option value="auto">Auto (Testar Todas as APIs)</option>
                                <option value="caixa">API Caixa Oficial</option>
                                <option value="heroku">API Heroku</option>
                                <option value="brasilapi">API Brasil</option>
                            </select>
                            <select id="modeSelect" class="p-2 border rounded dark:bg-gray-700 dark:border-gray-600 text-base">
                                <option value="direct">Acesso Direto</option>
                                <option value="proxy">Via Proxy CORS</option>
                                <option value="both">Tentar Ambos</option>
                            </select>
                        </div>
                        <input type="number" id="concursoNum" placeholder="Nº do concurso (opcional)" min="1" class="p-2 border rounded dark:bg-gray-700 dark:border-gray-600 text-base w-48">
                        <button id="fetchResultsBtn" class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded flex items-center">
                            <span id="fetchText">Buscar Resultados</span>
                            <svg id="loadingSpinner" class="animate-spin ml-2 h-4 w-4 text-white hidden" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                            </svg>
                        </button>
                    </div>
                    
                    <div id="apiStatus" class="mb-4 p-3 bg-gray-100 dark:bg-gray-700 rounded hidden">
                        <div class="font-semibold mb-1">Status da busca:</div>
                        <div id="apiStatusContent" class="text-sm"></div>
                    </div>
                </div>
                
                <!-- Analysis Results -->
                <div id="analysisResults" class="hidden">
                    <!-- Undrawn Combinations Section -->
                    <div class="mb-8 bg-blue-50 dark:bg-blue-900 rounded-lg p-4">
                        <h3 class="text-lg font-semibold text-blue-800 dark:text-blue-300 mb-3 flex items-center">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                            </svg>
                            Combinações Ainda Não Sorteadas
                            <span class="ml-2 bg-blue-200 dark:bg-blue-800 text-blue-800 dark:text-blue-200 text-sm font-medium px-2 py-0.5 rounded-full" id="undrawnCount">0</span>
                        </h3>
                        
                        <div class="mb-3 flex flex-wrap gap-2">
                            <button id="useUndrawnBtn" class="bg-primary hover:bg-primary/90 text-white text-sm font-medium py-1 px-3 rounded flex items-center">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" viewBox="0 0 20 20" fill="currentColor">
                                    <path d="M10 12a2 2 0 100-4 2 2 0 000 4z" />
                                    <path fill-rule="evenodd" d="M.458 10C1.732 5.943 5.522 3 10 3s8.268 2.943 9.542 7c-1.274 4.057-5.064 7-9.542 7S1.732 14.057.458 10zM14 10a4 4 0 11-8 0 4 4 0 018 0z" clip-rule="evenodd" />
                                </svg>
                                Usar Para Palpites
                            </button>
                            <button id="copyUndrawnBtn" class="bg-green-600 hover:bg-green-700 text-white text-sm font-medium py-1 px-3 rounded flex items-center">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" viewBox="0 0 20 20" fill="currentColor">
                                    <path d="M8 2a1 1 0 000 2h2a1 1 0 100-2H8z" />
                                    <path d="M3 5a2 2 0 012-2 3 3 0 003 3h2a3 3 0 003-3 2 2 0 012 2v6h-4.586l1.293-1.293a1 1 0 00-1.414-1.414l-3 3a1 1 0 000 1.414l3 3a1 1 0 001.414-1.414L10.414 13H15v3a2 2 0 01-2 2H5a2 2 0 01-2-2V5zM15 11h2a1 1 0 110 2h-2v-2z" />
                                </svg>
                                Copiar Lista
                            </button>
                            <button id="downloadUndrawnBtn" class="bg-blue-600 hover:bg-blue-700 text-white text-sm font-medium py-1 px-3 rounded flex items-center">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" viewBox="0 0 20 20" fill="currentColor">
                                    <path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z" clip-rule="evenodd" />
                                </svg>
                                Baixar Lista
                            </button>
                        </div>
                        
                        <div id="emptyUndrawnMessage" class="text-center py-6 text-blue-800 dark:text-blue-300 hidden">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 mx-auto mb-2 text-blue-500 dark:text-blue-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                            </svg>
                            <p class="text-lg font-medium">Todas as combinações deste tamanho já foram sorteadas pelo menos uma vez.</p>
                            <p class="mt-2">Tente selecionar um tamanho de grupo diferente ou analisar outros resultados.</p>
                        </div>
                        
                        <div id="undrawnCombinationsGrid" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-2 max-h-[300px] overflow-y-auto p-2">
                            <!-- Will be filled dynamically -->
                        </div>
                    </div>
                    
                    <!-- Top Combinations Section -->
                    <div class="mb-8 bg-green-50 dark:bg-green-900 rounded-lg p-4">
                        <h3 class="text-lg font-semibold text-green-800 dark:text-green-300 mb-3 flex items-center">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 11l7-7 7 7M5 19l7-7 7 7" />
                            </svg>
                            Combinações Mais Frequentes
                        </h3>
                        
                        <div id="topCombinationsGrid" class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <!-- Will be filled dynamically -->
                        </div>
                    </div>
                    
                    <!-- Frequency Table Section -->
                    <div class="mb-8">
                        <h3 class="text-lg font-semibold mb-3">Tabela de Frequência (Total: <span id="totalSorteos">0</span> sorteios)</h3>
                        
                        <div class="bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-700 rounded-lg overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-300 dark:divide-gray-700">
                                <thead>
                                    <tr class="bg-gray-100 dark:bg-gray-700">
                                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Combinação</th>
                                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Frequência</th>
                                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Porcentagem</th>
                                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Status</th>
                                    </tr>
                                </thead>
                                <tbody id="frequencyTableBody" class="divide-y divide-gray-200 dark:divide-gray-700">
                                    <!-- Will be filled dynamically -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Bets tab content -->
            <div id="betsContent" class="p-4 hidden">
                <h2 class="text-xl font-semibold mb-4">Geração de Palpites para Dia de Sorte</h2>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                    <div class="bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-700 rounded-lg p-4">
                        <h3 class="text-lg font-medium mb-3">Configurações</h3>
                        
                        <div class="mb-4">
                            <label class="block mb-1">Quantidade de dezenas por palpite:</label>
                            <input type="number" id="numberPerBet" value="7" min="7" max="15" class="p-2 border rounded w-full dark:bg-gray-700 dark:border-gray-600 text-base">
                            <div class="text-sm text-gray-500 dark:text-gray-400 mt-1">
                                Dia de Sorte permite apostas de 7 a 15 números.
                            </div>
                        </div>
                        
                        <div class="mb-4">
                            <label class="block mb-1">Distribuição por faixa:</label>
                            <div class="grid grid-cols-3 gap-2">
                                <div>
                                    <label for="lowRange" class="block text-sm text-gray-600 dark:text-gray-400">Baixas (1-10):</label>
                                    <input type="number" id="lowRange" value="3" min="0" max="15" class="p-2 border rounded w-full dark:bg-gray-700 dark:border-gray-600 text-base">
                                </div>
                                <div>
                                    <label for="mediumRange" class="block text-sm text-gray-600 dark:text-gray-400">Médias (11-20):</label>
                                    <input type="number" id="mediumRange" value="3" min="0" max="15" class="p-2 border rounded w-full dark:bg-gray-700 dark:border-gray-600 text-base">
                                </div>
                                <div>
                                    <label for="highRange" class="block text-sm text-gray-600 dark:text-gray-400">Altas (21-31):</label>
                                    <input type="number" id="highRange" value="1" min="0" max="15" class="p-2 border rounded w-full dark:bg-gray-700 dark:border-gray-600 text-base">
                                </div>
                            </div>
                            <div id="distributionSummary" class="text-sm mt-1 text-gray-600 dark:text-gray-400"></div>
                        </div>
                        
                        <div class="mb-4">
                            <label class="block mb-1">Quantidade de palpites a gerar:</label>
                            <div class="flex items-center gap-2">
                                <input type="number" id="betCount" value="10" min="1" max="100" class="p-2 border rounded w-24 dark:bg-gray-700 dark:border-gray-600 text-base">
                                <div class="text-sm text-gray-500 dark:text-gray-400">
                                    <span id="maxBetsMessage">(máximo disponível: 0)</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="flex flex-wrap gap-2">
                            <button id="generateBetsBtn" class="bg-primary hover:bg-primary/90 text-white font-medium py-2 px-4 rounded flex items-center">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor">
                                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-8.707l-3-3a1 1 0 00-1.414 1.414L10.586 9H7a1 1 0 100 2h3.586l-1.293 1.293a1 1 0 101.414 1.414l3-3a1 1 0 000-1.414z" clip-rule="evenodd" />
                                </svg>
                                Gerar Palpites
                            </button>
                            <button id="clearBetsBtn" class="bg-gray-600 hover:bg-gray-700 text-white font-medium py-2 px-4 rounded flex items-center">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor">
                                    <path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z" clip-rule="evenodd" />
                                </svg>
                                Limpar
                            </button>
                        </div>
                    </div>
                    
                    <div class="bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-700 rounded-lg p-4">
                        <h3 class="text-lg font-medium mb-3">Status</h3>
                        
                        <div class="bg-gray-100 dark:bg-gray-700 rounded-lg p-4 mb-4">
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <div class="text-sm text-gray-500 dark:text-gray-400">Tamanho da combinação</div>
                                    <div class="text-xl font-bold group-size-display">5</div>
                                </div>
                                <div>
                                    <div class="text-sm text-gray-500 dark:text-gray-400">Combinações disponíveis</div>
                                    <div class="text-xl font-bold"><span id="availableCombinations">0</span></div>
                                </div>
                                <div>
                                    <div class="text-sm text-gray-500 dark:text-gray-400">Modo atual</div>
                                    <div class="text-xl font-bold" id="currentMode">Todas</div>
                                </div>
                                <div>
                                    <div class="text-sm text-gray-500 dark:text-gray-400">Palpites gerados</div>
                                    <div class="text-xl font-bold" id="generatedBetsCount">0</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="flex flex-wrap gap-2">
                            <button id="downloadBetsBtn" class="bg-green-600 hover:bg-green-700 text-white font-medium py-2 px-4 rounded flex items-center">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor">
                                    <path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z" clip-rule="evenodd" />
                                </svg>
                                Baixar Palpites
                            </button>
                            <button id="printBetsBtn" class="bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded flex items-center">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor">
                                    <path fill-rule="evenodd" d="M5 4v3H4a2 2 0 00-2 2v3a2 2 0 002 2h1v2a2 2 0 002 2h6a2 2 0 002-2v-2h1a2 2 0 002-2V9a2 2 0 00-2-2h-1V4a2 2 0 00-2-2H7a2 2 0 00-2 2zm8 0H7v3h6V4zm0 8H7v4h6v-4z" clip-rule="evenodd" />
                                </svg>
                                Imprimir
                            </button>
                            <button id="copyBetsBtn" class="bg-indigo-600 hover:bg-indigo-700 text-white font-medium py-2 px-4 rounded flex items-center">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor">
                                    <path d="M8 2a1 1 0 000 2h2a1 1 0 100-2H8z" />
                                    <path d="M3 5a2 2 0 012-2 3 3 0 003 3h2a3 3 0 003-3 2 2 0 012 2v6h-4.586l1.293-1.293a1 1 0 00-1.414-1.414l-3 3a1 1 0 000 1.414l3 3a1 1 0 001.414-1.414L10.414 13H15v3a2 2 0 01-2 2H5a2 2 0 01-2-2V5zM15 11h2a1 1 0 110 2h-2v-2z" />
                                </svg>
                                Copiar Dezenas
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Bet Results Section -->
                <div id="betResultsContainer" class="hidden">
                    <div class="flex items-center justify-between mb-3">
                        <h3 class="text-lg font-semibold">Palpites Gerados</h3>
                        <div class="flex gap-2">
                            <div class="bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200 px-3 py-1 rounded-full text-sm font-medium flex items-center">
                                <span class="w-3 h-3 rounded-full bg-green-500 mr-1"></span>
                                Baixas: <span id="lowBetsCount">0</span>
                            </div>
                            <div class="bg-yellow-100 dark:bg-yellow-900 text-yellow-800 dark:text-yellow-200 px-3 py-1 rounded-full text-sm font-medium flex items-center">
                                <span class="w-3 h-3 rounded-full bg-yellow-500 mr-1"></span>
                                Médias: <span id="mediumBetsCount">0</span>
                            </div>
                            <div class="bg-red-100 dark:bg-red-900 text-red-800 dark:text-red-200 px-3 py-1 rounded-full text-sm font-medium flex items-center">
                                <span class="w-3 h-3 rounded-full bg-red-500 mr-1"></span>
                                Altas: <span id="highBetsCount">0</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="tabs flex border-b dark:border-gray-700 mb-4">
                        <button id="allBetsTab" class="tab-active py-2 px-4 font-medium">Todos</button>
                        <button id="lowBetsTab" class="tab-inactive py-2 px-4 font-medium">Baixas</button>
                        <button id="mediumBetsTab" class="tab-inactive py-2 px-4 font-medium">Médias</button>
                        <button id="highBetsTab" class="tab-inactive py-2 px-4 font-medium">Altas</button>
                    </div>
                    
                    <div id="betsGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                        <!-- Will be filled dynamically -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Estado atual da aplicação
            const state = {
                currentGroupSize: 5, // Tamanho padrão inicial: 5 dígitos
                allCombinations: [], // Todas as combinações do tamanho atual
                validCombinations: [], // Combinações válidas/filtradas
                undrawnCombinations: [], // Combinações não sorteadas
                mode: 'all', // all, undrawn
                generatedBets: [], // Palpites gerados
                results: [], // Resultados da análise
                totalResults: 0, // Total de resultados analisados
            };
            
            // Informações sobre os diferentes tamanhos de grupos
            const groupSizeInfo = {
                1: {
                    total: 10,
                    valid: 10,
                    description: "Analisa padrões baseados em números que contêm apenas um dígito específico."
                },
                2: {
                    total: 45,
                    valid: 45,
                    description: "Analisa padrões onde apenas 2 dígitos específicos são utilizados nos números."
                },
                3: {
                    total: 120,
                    valid: 120,
                    description: "Analisa padrões formados por 3 dígitos diferentes, gerando combinações específicas."
                },
                4: {
                    total: 210,
                    valid: 210,
                    description: "Análise mais complexa usando 4 dígitos, oferecendo boa diversidade de números."
                },
                5: {
                    total: 252,
                    valid: 126,
                    description: "A análise mais equilibrada para o jogo Dia de Sorte, pois cada combinação gera uma quantidade adequada de números possíveis."
                },
                6: {
                    total: 210,
                    valid: 210,
                    description: "Analisa padrões baseados em 6 dígitos diferentes, gerando grande variedade de números."
                },
                7: {
                    total: 120,
                    valid: 120,
                    description: "Analisa padrões com 7 dígitos, criando muitas possibilidades de números por combinação."
                },
                8: {
                    total: 45,
                    valid: 45,
                    description: "Analisa padrões baseados na ausência de apenas 2 dígitos específicos."
                },
                9: {
                    total: 10,
                    valid: 10,
                    description: "Analisa padrões baseados na ausência de apenas 1 dígito específico."
                },
                10: {
                    total: 1,
                    valid: 1,
                    description: "Utiliza todos os dígitos possíveis (0-9), abrangendo todos os números possíveis."
                }
            };
            
            // Armazenamento de cache local para dados das APIs
            const LOCAL_CACHE = {
                setCached: function(key, data, expiresInMinutes = 60) {
                    try {
                        const item = {
                            data: data,
                            expires: new Date().getTime() + expiresInMinutes * 60 * 1000
                        };
                        localStorage.setItem(key, JSON.stringify(item));
                        return true;
                    } catch (e) {
                        console.error("Erro ao armazenar em cache:", e);
                        return false;
                    }
                },
                
                getCached: function(key) {
                    try {
                        const item = JSON.parse(localStorage.getItem(key));
                        if (!item) return null;
                        
                        // Verifica se expirou
                        if (new Date().getTime() > item.expires) {
                            localStorage.removeItem(key);
                            return null;
                        }
                        
                        return item.data;
                    } catch (e) {
                        console.error("Erro ao recuperar cache:", e);
                        return null;
                    }
                }
            };
            
            // Configurações das APIs
            const API_CONFIG = {
                // APIs oficiais
                CAIXA_URL: 'https://servicebus2.caixa.gov.br/portaldeloterias/api/diadesorte',
                HEROKU_URL: 'https://loteriascaixa-api.herokuapp.com/api/dia-de-sorte',
                BRASIL_URL: 'https://brasilapi.com.br/api/loterias/v1/dia-de-sorte',
                
                // Serviços de proxy CORS
                CORS_PROXY_URLS: [
                    'https://corsproxy.io/?',
                    'https://api.allorigins.win/raw?url=',
                    'https://cors-anywhere.herokuapp.com/'
                ]
            };
            
            // Função para gerar todas as combinações de k elementos em um array
            function generateCombinations(array, k) {
                const result = [];
                
                function backtrack(startIndex, currentCombination) {
                    if (currentCombination.length === k) {
                        result.push([...currentCombination]);
                        return;
                    }
                    
                    for (let i = startIndex; i < array.length; i++) {
                        currentCombination.push(array[i]);
                        backtrack(i + 1, currentCombination);
                        currentCombination.pop();
                    }
                }
                
                backtrack(0, []);
                return result;
            }
            
            // Função para gerar todas as combinações de dígitos de um tamanho específico
            function generateDigitCombinations(size) {
                const digits = [0, 1, 2, 3, 4, 5, 6, 7, 8, 9];
                const combinations = generateCombinations(digits, size);
                return combinations.map(combo => combo.join(','));
            }
            
            // Função para filtrar as combinações válidas para tamanho 5
            function filterSize5Combinations(allCombinations) {
                // Estas são as 126 combinações válidas (de 252 possíveis) para tamanho 5
                const validCombosSize5 = [
                    "0,1,2,3,4", "0,1,2,3,5", "0,1,2,3,6", "0,1,2,3,7", "0,1,2,3,8", "0,1,2,3,9", 
                    "0,1,2,4,5", "0,1,2,4,6", "0,1,2,4,7", "0,1,2,4,8", "0,1,2,4,9", "0,1,2,5,6",     
                    "0,1,2,5,7", "0,1,2,5,8", "0,1,2,5,9", "0,1,2,6,7", "0,1,2,6,8", "0,1,2,6,9",     
                    "0,1,2,7,8", "0,1,2,7,9", "0,1,2,8,9", "0,1,3,4,5", "0,1,3,4,6", "0,1,3,4,7",  
                    "0,1,3,4,8", "0,1,3,4,9", "0,1,3,5,6", "0,1,3,5,7", "0,1,3,5,8", "0,1,3,5,9",  
                    "0,1,3,6,7", "0,1,3,6,8", "0,1,3,6,9", "0,1,3,7,8", "0,1,3,7,9", "0,1,3,8,9",     
                    "0,1,4,5,6", "0,1,4,5,7", "0,1,4,5,8", "0,1,4,5,9", "0,1,4,6,7", "0,1,4,6,8",     
                    "0,1,4,6,9", "0,1,4,7,8", "0,1,4,7,9", "0,1,4,8,9", "0,1,5,6,7", "0,1,5,6,8",  
                    "0,1,5,7,9", "0,1,5,8,9", "0,1,6,7,8", "0,1,6,7,9", "0,1,6,8,9", "0,1,7,8,9",  
                    "0,2,3,4,7", "0,2,3,4,8", "0,2,3,4,9", "0,2,3,5,6", "0,2,3,5,7", "0,2,3,5,8",       
                    "0,2,3,6,8", "0,2,3,6,9", "0,2,3,7,8", "0,2,3,7,9", "0,2,3,8,9", "0,2,4,5,6",    
                    "0,2,4,6,8", "0,2,4,6,9", "0,2,4,7,8", "0,2,4,7,9", "0,2,4,8,9", "0,2,5,6,7",      
                    "0,2,5,7,8", "0,2,5,7,9", "0,2,5,8,9", "0,2,6,7,8", "0,2,6,7,9", "0,2,6,8,9",      
                    "1,2,3,4,6", "1,2,3,4,7", "1,2,3,4,8", "1,2,3,4,9", "1,2,3,5,6", "1,2,3,5,7",      
                    "1,2,3,6,8", "1,2,3,6,9", "1,2,3,7,8", "1,2,3,7,9", "1,2,3,8,9", "1,2,4,5,6",      
                    "1,2,4,5,9", "1,2,4,6,7", "1,2,4,6,8", "1,2,4,6,9", "1,2,4,7,8", "1,2,4,7,9",     
                    "1,2,5,6,8", "1,2,5,6,9", "1,2,5,7,8", "1,2,5,7,9", "1,2,5,8,9", "1,2,6,7,8",     
                    "1,2,6,7,9", "1,2,6,8,9", "1,2,7,8,9", "0,2,4,5,7", "0,2,4,5,8", "0,2,4,5,9",     
                    "0,2,4,6,7", "1,2,4,8,9", "1,2,5,6,7", "1,2,4,5,7", "1,2,4,5,8", "0,2,3,5,9",
                    "1,2,3,5,8", "1,2,3,5,9", "1,2,3,6,7", "0,2,7,8,9", "1,2,3,4,5", "0,2,3,6,7", 
                    "0,2,5,6,8", "0,2,5,6,9", "0,1,5,6,9", "0,1,5,7,8", "0,2,3,4,5", "0,2,3,4,6"
                ];
                
                return allCombinations.filter(combo => validCombosSize5.includes(combo));
            }
            
            // Função para atualizar as combinações com base no tamanho selecionado
            function updateCombinations() {
                // Gerar todas as combinações possíveis
                state.allCombinations = generateDigitCombinations(state.currentGroupSize);
                
                // Aplicar filtro para tamanho 5 (para outros tamanhos, usamos todas as combinações)
                if (state.currentGroupSize === 5) {
                    state.validCombinations = filterSize5Combinations(state.allCombinations);
                } else {
                    state.validCombinations = [...state.allCombinations];
                }
                
                // Atualizar UI
                updateUI();
            }
            
            // Função para atualizar a interface do usuário
            function updateUI() {
                // Atualizar seletor de tamanho
                document.querySelectorAll('.digit-size-btn').forEach(btn => {
                    const size = parseInt(btn.getAttribute('data-size'));
                    
                    if (size === state.currentGroupSize) {
                        btn.classList.remove('border-gray-300', 'dark:border-gray-600', 'hover:border-primary', 'dark:hover:border-primary');
                        btn.classList.add('border-primary', 'dark:border-primary', 'bg-primary/10', 'dark:bg-primary/20');
                    } else {
                        btn.classList.remove('border-primary', 'dark:border-primary', 'bg-primary/10', 'dark:bg-primary/20');
                        btn.classList.add('border-gray-300', 'dark:border-gray-600', 'hover:border-primary', 'dark:hover:border-primary');
                    }
                });
                
                // Atualizar displays de tamanho de grupo
                document.getElementById('sizeIndicator').textContent = state.currentGroupSize;
                document.querySelectorAll('.group-size-display').forEach(el => {
                    el.textContent = state.currentGroupSize;
                });
                
                // Atualizar informações do tamanho
                const info = groupSizeInfo[state.currentGroupSize];
                document.getElementById('groupSizeText').textContent = state.currentGroupSize;
                document.getElementById('totalCombinationsText').textContent = info.total;
                document.getElementById('validCombinationsText').textContent = info.valid;
                document.getElementById('sizeDescription').textContent = info.description;
                
                // Atualizar contadores de combinações
                document.getElementById('totalCombinationsCount').textContent = state.validCombinations.length;
                document.getElementById('availableCombinations').textContent = state.validCombinations.length;
                
                // Atualizar modo atual
                document.getElementById('currentMode').textContent = state.mode === 'all' ? 'Todas' : 'Não Sorteadas';
                
                // Atualizar o contador de palpites
                document.getElementById('generatedBetsCount').textContent = state.generatedBets.length;
                
                // Atualizar mensagem de máximo de palpites
                const maxBets = state.validCombinations.length;
                document.getElementById('maxBetsMessage').textContent = `(máximo disponível: ${maxBets})`;
                
                // Limitar o input de quantidade de palpites
                const betCountInput = document.getElementById('betCount');
                betCountInput.max = maxBets;
                if (parseInt(betCountInput.value) > maxBets) {
                    betCountInput.value = maxBets;
                }
                
                // Preencher a grade de combinações
                const combinationsGrid = document.getElementById('combinationsGrid');
                combinationsGrid.innerHTML = '';
                
                state.validCombinations.forEach(combo => {
                    const comboDiv = document.createElement('div');
                    comboDiv.className = 'bg-gray-50 dark:bg-gray-800 p-2 rounded-lg border border-gray-200 dark:border-gray-700 text-center';
                    comboDiv.textContent = combo;
                    combinationsGrid.appendChild(comboDiv);
                });
                
                // Limpar a área de resultados de análise se houver uma mudança de tamanho
                if (state.undrawnCombinations.length > 0 && state.undrawnCombinations[0].split(',').length !== state.currentGroupSize) {
                    document.getElementById('analysisResults').classList.add('hidden');
                    state.undrawnCombinations = [];
                }
            }
            
            // Função para alternar entre abas
            function setupTabs() {
                const combinationsTab = document.getElementById('combinationsTab');
                const analysisTab = document.getElementById('analysisTab');
                const betsTab = document.getElementById('betsTab');
                
                const combinationsContent = document.getElementById('combinationsContent');
                const analysisContent = document.getElementById('analysisContent');
                const betsContent = document.getElementById('betsContent');
                
                function setActiveTab(tab, content) {
                    // Remover classes ativas de todas as abas
                    [combinationsTab, analysisTab, betsTab].forEach(t => {
                        t.classList.remove('tab-active');
                        t.classList.add('tab-inactive');
                    });
                    
                    // Esconder todos os conteúdos
                    [combinationsContent, analysisContent, betsContent].forEach(c => {
                        c.classList.add('hidden');
                    });
                    
                    // Definir a aba ativa
                    tab.classList.remove('tab-inactive');
                    tab.classList.add('tab-active');
                    
                    // Mostrar o conteúdo correspondente
                    content.classList.remove('hidden');
                }
                
                combinationsTab.addEventListener('click', () => setActiveTab(combinationsTab, combinationsContent));
                analysisTab.addEventListener('click', () => setActiveTab(analysisTab, analysisContent));
                betsTab.addEventListener('click', () => setActiveTab(betsTab, betsContent));
            }
            
            // Função para generar números possíveis a partir de uma combinação
            function generatePossibleNumbers(combination, maxNumber = 31) {
                const digits = combination.split(',');
                const possibleNumbers = [];
                
                for (let i = 0; i < digits.length; i++) {
                    for (let j = 0; j < digits.length; j++) {
                        const num = parseInt(digits[i] + digits[j]);
                        // Adicionar número se estiver no intervalo e não estiver já na lista
                        if (num > 0 && num <= maxNumber && !possibleNumbers.includes(num)) {
                            possibleNumbers.push(num);
                        }
                    }
                }
                
                return possibleNumbers.sort((a, b) => a - b);
            }
            
            // Função para formatar número com zero à esquerda se necessário
            function formatNumber(num) {
                return num < 10 ? '0' + num : num.toString();
            }
            
            // Função para obter classe de categoria para um número
            function getNumberCategoryClass(num) {
                if (num <= 10) return 'number-low';
                if (num <= 20) return 'number-medium';
                return 'number-high';
            }
            
            // Function to extract digits from a number
            function getDigits(num) {
                return num.toString().padStart(2, '0').split('').map(Number);
            }
            
            // Function to analyze the frequency of digit combinations in historical results
            function analyzeFrequency() {
                const resultsText = document.getElementById('historicalResults').value.trim();
                if (!resultsText) {
                    alert('Por favor, insira os resultados históricos.');
                    return;
                }

                const results = [];
                const lines = resultsText.split('\n');

                // Parse each line of results
                for (const line of lines) {
                    if (line.trim() === '') continue;
                    
                    const numbers = line.trim().split(/\s+/).map(n => parseInt(n.trim()));
                    if (numbers.length >= 7) { // Ensure there are at least 7 numbers (Dia de Sorte standard)
                        results.push(numbers);
                    }
                }

                if (results.length === 0) {
                    alert('Nenhum resultado válido encontrado. Verifique o formato.');
                    return;
                }
                
                // Armazenar para uso posterior
                state.results = results;
                state.totalResults = results.length;

                // Count digit occurrences in each result
                const digitCombinationCounts = {};
                
                // Inicializar contadores para todas as combinações
                state.validCombinations.forEach(combo => {
                    digitCombinationCounts[combo] = 0;
                });
                
                // Iterate through each result
                results.forEach(result => {
                    // Get all digits from all numbers in this result
                    const allDigits = new Set();
                    result.forEach(num => {
                        getDigits(num).forEach(digit => allDigits.add(digit));
                    });
                    
                    // Convert to array and sort
                    const digitsArray = Array.from(allDigits).sort((a, b) => a - b);
                    
                    // Verificar combinações do tamanho atual
                    if (digitsArray.length >= state.currentGroupSize) {
                        // Gerar todas as combinações possíveis do tamanho atual
                        const resultCombinations = generateCombinations(digitsArray, state.currentGroupSize);
                        
                        // Verificar quais combinações estão presentes
                        resultCombinations.forEach(combination => {
                            const comboStr = combination.join(',');
                            if (state.validCombinations.includes(comboStr)) {
                                digitCombinationCounts[comboStr]++;
                            }
                        });
                    }
                });

                // Identificar combinações que ainda não foram sorteadas
                state.undrawnCombinations = state.validCombinations.filter(combo => 
                    digitCombinationCounts[combo] === 0
                );
                
                // Convert to array for sorting
                const combinationsArray = Object.entries(digitCombinationCounts)
                    .map(([combo, count]) => ({ combo, count }))
                    .sort((a, b) => b.count - a.count);

                // Exibir resultados da análise
                document.getElementById('analysisResults').classList.remove('hidden');
                document.getElementById('totalSorteos').textContent = results.length;
                
                // Mostrar o contador de combinações não sorteadas
                document.getElementById('undrawnCount').textContent = state.undrawnCombinations.length;
                
                // Preencher a grade de combinações não sorteadas
                const undrawnGrid = document.getElementById('undrawnCombinationsGrid');
                const emptyMessage = document.getElementById('emptyUndrawnMessage');
                
                undrawnGrid.innerHTML = '';
                
                if (state.undrawnCombinations.length > 0) {
                    undrawnGrid.classList.remove('hidden');
                    emptyMessage.classList.add('hidden');
                    
                    state.undrawnCombinations.forEach(combo => {
                        const comboDiv = document.createElement('div');
                        comboDiv.className = 'bg-blue-100 dark:bg-blue-800 p-2 rounded-lg border border-blue-300 dark:border-blue-700 text-center text-blue-800 dark:text-blue-200';
                        comboDiv.textContent = combo;
                        undrawnGrid.appendChild(comboDiv);
                    });
                } else {
                    undrawnGrid.classList.add('hidden');
                    emptyMessage.classList.remove('hidden');
                }
                
                // Mostrar as combinações mais frequentes (Top 5)
                const topCombos = combinationsArray.filter(item => item.count > 0).slice(0, 5);
                const topGrid = document.getElementById('topCombinationsGrid');
                
                topGrid.innerHTML = '';
                
                topCombos.forEach((item, index) => {
                    const percentage = ((item.count / results.length) * 100).toFixed(1);
                    const comboDiv = document.createElement('div');
                    comboDiv.className = 'bg-green-100 dark:bg-green-900 p-3 rounded-lg border-2 border-green-500';
                    comboDiv.innerHTML = `
                        <div class="font-bold text-lg text-green-800 dark:text-green-200">${index + 1}. ${item.combo}</div>
                        <div class="text-green-700 dark:text-green-300">
                            ${item.count} de ${results.length} resultados (${percentage}%)
                        </div>
                        <div class="text-sm mt-2 text-green-700 dark:text-green-400">
                            Esta combinação apareceu em ${percentage}% dos resultados analisados.
                        </div>
                    `;
                    topGrid.appendChild(comboDiv);
                });
                
                // Preencher a tabela de frequência
                const tableBody = document.getElementById('frequencyTableBody');
                tableBody.innerHTML = '';
                
                combinationsArray.forEach(({ combo, count }) => {
                    const percentage = ((count / results.length) * 100).toFixed(1);
                    
                    const row = document.createElement('tr');
                    
                    // Determinar status e cor
                    let statusClass = '';
                    let statusText = '';
                    
                    if (count === 0) {
                        statusClass = 'bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200';
                        statusText = 'Nunca Sorteada';
                    } else if (topCombos.some(item => item.combo === combo)) {
                        statusClass = 'bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200';
                        statusText = 'Alta Frequência';
                    }
                    
                    row.className = count === 0 ? 'bg-blue-50 dark:bg-blue-950' : '';
                    row.innerHTML = `
                        <td class="px-4 py-3">${combo}</td>
                        <td class="px-4 py-3">${count} de ${results.length}</td>
                        <td class="px-4 py-3">${percentage}%</td>
                        <td class="px-4 py-3">
                            <span class="px-2 py-1 rounded-full text-xs font-medium ${statusClass}">${count === 0 ? 'Nunca Sorteada' : (percentage > 10 ? 'Alta Frequência' : 'Normal')}</span>
                        </td>
                    `;
                    
                    tableBody.appendChild(row);
                });
                
                // Mudar para a aba de análise
                document.getElementById('analysisTab').click();
            }
            
            // Função para usar apenas as combinações não sorteadas
            function useUndrawnCombinations() {
                if (state.undrawnCombinations.length === 0) {
                    alert('Não há combinações não sorteadas para usar.');
                    return;
                }
                
                // Atualizar a aplicação para usar apenas combinações não sorteadas
                state.validCombinations = [...state.undrawnCombinations];
                state.mode = 'undrawn';
                
                // Atualizar UI
                updateUI();
                
                // Mudar para a aba de palpites
                document.getElementById('betsTab').click();
                
                alert(`Agora usando apenas as ${state.undrawnCombinations.length} combinações não sorteadas. Você pode gerar palpites a partir delas.`);
            }
            
            // Função para gerenciar a distribuição por faixa
            function setupRangeDistribution() {
                const numberPerBetInput = document.getElementById('numberPerBet');
                const lowRangeInput = document.getElementById('lowRange');
                const mediumRangeInput = document.getElementById('mediumRange');
                const highRangeInput = document.getElementById('highRange');
                
                // Função para ajustar os valores mantendo a soma igual ao total
                function adjustValues(changedInput) {
                    const targetTotal = parseInt(numberPerBetInput.value);
                    
                    // Limitar os valores aos limites permitidos
                    let lowVal = Math.max(0, Math.min(targetTotal, parseInt(lowRangeInput.value) || 0));
                    let mediumVal = Math.max(0, Math.min(targetTotal, parseInt(mediumRangeInput.value) || 0));
                    let highVal = Math.max(0, Math.min(targetTotal, parseInt(highRangeInput.value) || 0));
                    
                    // Atualizar os valores nos campos
                    lowRangeInput.value = lowVal;
                    mediumRangeInput.value = mediumVal;
                    highRangeInput.value = highVal;
                    
                    const currentTotal = lowVal + mediumVal + highVal;
                    
                    // Se o total já está correto, não precisa ajustar
                    if (currentTotal === targetTotal) {
                        updateDistributionSummary();
                        return;
                    }
                    
                    // Ajustar proporcionalmente
                    if (changedInput === numberPerBetInput) {
                        // Se mudar o número total de dezenas, ajustar proporcionalmente
                        if (currentTotal === 0) {
                            // Se todos estão zerados, distribuir igualmente
                            const third = Math.floor(targetTotal / 3);
                            lowRangeInput.value = third;
                            mediumRangeInput.value = third;
                            highRangeInput.value = targetTotal - (2 * third);
                        } else {
                            // Distribuição proporcional
                            const factor = targetTotal / currentTotal;
                            
                            let newLow = Math.round(lowVal * factor);
                            let newMedium = Math.round(mediumVal * factor);
                            let newHigh = targetTotal - newLow - newMedium;
                            
                            lowRangeInput.value = newLow;
                            mediumRangeInput.value = newMedium;
                            highRangeInput.value = newHigh;
                        }
                    } else {
                        // Se um campo específico foi modificado
                        const difference = targetTotal - currentTotal;
                        
                        if (changedInput === lowRangeInput) {
                            // Distribuir a diferença entre os outros campos
                            const remainingTotal = mediumVal + highVal;
                            if (remainingTotal === 0) {
                                mediumRangeInput.value = Math.floor(difference / 2);
                                highRangeInput.value = difference - mediumRangeInput.value;
                            } else {
                                const mediumRatio = mediumVal / remainingTotal;
                                const newMedium = Math.round(difference * mediumRatio) + mediumVal;
                                const newHigh = targetTotal - lowVal - newMedium;
                                
                                mediumRangeInput.value = newMedium;
                                highRangeInput.value = newHigh;
                            }
                        } else if (changedInput === mediumRangeInput) {
                            // Distribuir a diferença entre os outros campos
                            const remainingTotal = lowVal + highVal;
                            if (remainingTotal === 0) {
                                lowRangeInput.value = Math.floor(difference / 2);
                                highRangeInput.value = difference - lowRangeInput.value;
                            } else {
                                const lowRatio = lowVal / remainingTotal;
                                const newLow = Math.round(difference * lowRatio) + lowVal;
                                const newHigh = targetTotal - mediumVal - newLow;
                                
                                lowRangeInput.value = newLow;
                                highRangeInput.value = newHigh;
                            }
                        } else if (changedInput === highRangeInput) {
                            // Distribuir a diferença entre os outros campos
                            const remainingTotal = lowVal + mediumVal;
                            if (remainingTotal === 0) {
                                lowRangeInput.value = Math.floor(difference / 2);
                                mediumRangeInput.value = difference - lowRangeInput.value;
                            } else {
                                const lowRatio = lowVal / remainingTotal;
                                const newLow = Math.round(difference * lowRatio) + lowVal;
                                const newMedium = targetTotal - highVal - newLow;
                                
                                lowRangeInput.value = newLow;
                                mediumRangeInput.value = newMedium;
                            }
                        }
                    }
                    
                    // Verificar valores finais
                    const finalTotal = parseInt(lowRangeInput.value) + parseInt(mediumRangeInput.value) + parseInt(highRangeInput.value);
                    
                    if (finalTotal !== targetTotal) {
                        // Ajustar o último valor se necessário
                        highRangeInput.value = targetTotal - parseInt(lowRangeInput.value) - parseInt(mediumRangeInput.value);
                    }
                    
                    updateDistributionSummary();
                }
                
                // Função para mostrar um resumo da distribuição atual
                function updateDistributionSummary() {
                    const totalDezenas = parseInt(numberPerBetInput.value);
                    const lowVal = parseInt(lowRangeInput.value) || 0;
                    const mediumVal = parseInt(mediumRangeInput.value) || 0;
                    const highVal = parseInt(highRangeInput.value) || 0;
                    
                    const distributionSummary = document.getElementById('distributionSummary');
                    distributionSummary.textContent = `Total: ${lowVal + mediumVal + highVal}/${totalDezenas} dezenas (${lowVal} baixas, ${mediumVal} médias, ${highVal} altas)`;
                    
                    // Destacar se a soma não estiver correta
                    if (lowVal + mediumVal + highVal !== totalDezenas) {
                        distributionSummary.classList.add('text-red-500', 'dark:text-red-400');
                    } else {
                        distributionSummary.classList.remove('text-red-500', 'dark:text-red-400');
                    }
                }
                
                // Adicionar event listeners
                lowRangeInput.addEventListener('change', () => adjustValues(lowRangeInput));
                mediumRangeInput.addEventListener('change', () => adjustValues(mediumRangeInput));
                highRangeInput.addEventListener('change', () => adjustValues(highRangeInput));
                numberPerBetInput.addEventListener('change', () => adjustValues(numberPerBetInput));
                
                // Inicializar o resumo da distribuição
                updateDistributionSummary();
            }
            
            // Function to shuffle array (Fisher-Yates algorithm)
            function shuffleArray(array) {
                for (let i = array.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [array[i], array[j]] = [array[j], array[i]];
                }
                return array;
            }
            
            // Function to generate a balanced betting sequence with specified distribution
            function generateBalancedBettingSequence(possibleNumbers, numbersPerBet, lowCount, mediumCount, highCount) {
                if (possibleNumbers.length < numbersPerBet) {
                    return null; // Not enough numbers to form a complete bet
                }
                
                // Verify the sum of counts matches the total numbers per bet
                const totalRequested = lowCount + mediumCount + highCount;
                if (totalRequested !== numbersPerBet) {
                    console.warn(`Ajuste nos números solicitados: total ${totalRequested}, necessário ${numbersPerBet}`);
                    
                    // Adjust proportionally
                    const factor = numbersPerBet / totalRequested;
                    lowCount = Math.round(lowCount * factor);
                    mediumCount = Math.round(mediumCount * factor);
                    highCount = numbersPerBet - lowCount - mediumCount;
                }
                
                // Categorize available numbers
                const lowNumbers = possibleNumbers.filter(num => num <= 10);
                const mediumNumbers = possibleNumbers.filter(num => num > 10 && num <= 20);
                const highNumbers = possibleNumbers.filter(num => num > 20);
                
                // Check if we have enough numbers in each category
                if (lowNumbers.length < lowCount || mediumNumbers.length < mediumCount || highNumbers.length < highCount) {
                    // Not enough numbers in required distribution, try to adjust
                    let deficit = 0;
                    let adjustedLowCount = Math.min(lowCount, lowNumbers.length);
                    deficit += lowCount - adjustedLowCount;
                    
                    let adjustedMediumCount = Math.min(mediumCount, mediumNumbers.length);
                    deficit += mediumCount - adjustedMediumCount;
                    
                    let adjustedHighCount = Math.min(highCount, highNumbers.length);
                    deficit += highCount - adjustedHighCount;
                    
                    // If we can't meet the deficit, return null
                    if (adjustedLowCount + adjustedMediumCount + adjustedHighCount + deficit > possibleNumbers.length) {
                        console.warn("Não é possível gerar palpite com a distribuição solicitada");
                        return null;
                    }
                    
                    // Distribute deficit among available categories
                    const remainingLow = lowNumbers.length - adjustedLowCount;
                    const remainingMedium = mediumNumbers.length - adjustedMediumCount;
                    const remainingHigh = highNumbers.length - adjustedHighCount;
                    
                    // Distribute deficit proportionally to remaining capacity
                    const totalRemaining = remainingLow + remainingMedium + remainingHigh;
                    if (totalRemaining > 0) {
                        const lowDeficit = Math.min(Math.round((remainingLow / totalRemaining) * deficit), remainingLow);
                        adjustedLowCount += lowDeficit;
                        deficit -= lowDeficit;
                        
                        const mediumDeficit = Math.min(Math.round((remainingMedium / totalRemaining) * deficit), remainingMedium);
                        adjustedMediumCount += mediumDeficit;
                        deficit -= mediumDeficit;
                        
                        // Assign any remaining deficit to high numbers
                        adjustedHighCount += deficit;
                    }
                    
                    lowCount = adjustedLowCount;
                    mediumCount = adjustedMediumCount;
                    highCount = adjustedHighCount;
                }
                
                // Shuffle each category to get random selection
                shuffleArray(lowNumbers);
                shuffleArray(mediumNumbers);
                shuffleArray(highNumbers);
                
                // Select required numbers from each category
                const selectedLow = lowNumbers.slice(0, lowCount);
                const selectedMedium = mediumNumbers.slice(0, mediumCount);
                const selectedHigh = highNumbers.slice(0, highCount);
                
                // Combine and sort for final bet
                return [...selectedLow, ...selectedMedium, ...selectedHigh].sort((a, b) => a - b);
            }
            
            // Função para gerar palpites
            function generateBets() {
                // Obter parâmetros
                const numbersPerBet = parseInt(document.getElementById('numberPerBet').value);
                const lowRange = parseInt(document.getElementById('lowRange').value);
                const mediumRange = parseInt(document.getElementById('mediumRange').value);
                const highRange = parseInt(document.getElementById('highRange').value);
                const betCount = parseInt(document.getElementById('betCount').value);
                
                // Verificar se há combinações disponíveis
                if (state.validCombinations.length === 0) {
                    alert('Não há combinações disponíveis para gerar palpites.');
                    return;
                }
                
                // Limitar número de palpites
                const maxBets = Math.min(betCount, state.validCombinations.length);
                
                // Embaralhar as combinações para selecionar aleatoriamente
                const shuffledCombinations = shuffleArray([...state.validCombinations]);
                const selectedCombinations = shuffledCombinations.slice(0, maxBets);
                
                // Limpar palpites anteriores
                state.generatedBets = [];
                
                // Contadores para categorias
                let lowCount = 0, mediumCount = 0, highCount = 0;
                
                // Gerar palpites para cada combinação selecionada
                selectedCombinations.forEach((combination, index) => {
                    const digits = combination.split(',');
                    const possibleNumbers = generatePossibleNumbers(digits);
                    
                    // Gerar palpite balanceado
                    const bet = generateBalancedBettingSequence(possibleNumbers, numbersPerBet, lowRange, mediumRange, highRange);
                    
                    if (bet) {
                        // Contar dezenas por categoria
                        const lowDezenas = bet.filter(num => num <= 10).length;
                        const mediumDezenas = bet.filter(num => num > 10 && num <= 20).length;
                        const highDezenas = bet.filter(num => num > 20).length;
                        
                        // Categorizar o palpite com base no tipo predominante
                        let category;
                        if (lowDezenas >= mediumDezenas && lowDezenas >= highDezenas) {
                            category = 'low';
                            lowCount++;
                        } else if (mediumDezenas >= lowDezenas && mediumDezenas >= highDezenas) {
                            category = 'medium';
                            mediumCount++;
                        } else {
                            category = 'high';
                            highCount++;
                        }
                        
                        // Armazenar o palpite
                        state.generatedBets.push({
                            index: index + 1,
                            combination: combination,
                            numbers: bet.map(num => formatNumber(num)),
                            category: category,
                            distribution: {
                                low: lowDezenas,
                                medium: mediumDezenas,
                                high: highDezenas
                            }
                        });
                    }
                });
                
                // Exibir resultados
                document.getElementById('betResultsContainer').classList.remove('hidden');
                document.getElementById('generatedBetsCount').textContent = state.generatedBets.length;
                document.getElementById('lowBetsCount').textContent = lowCount;
                document.getElementById('mediumBetsCount').textContent = mediumCount;
                document.getElementById('highBetsCount').textContent = highCount;
                
                // Preencher a grade de palpites
                renderBets('all');
            }
            
            // Função para renderizar os palpites
            function renderBets(filter = 'all') {
                const betsGrid = document.getElementById('betsGrid');
                betsGrid.innerHTML = '';
                
                // Filtrar os palpites
                let filteredBets = state.generatedBets;
                if (filter !== 'all') {
                    filteredBets = state.generatedBets.filter(bet => bet.category === filter);
                }
                
                // Exibir mensagem se não houver palpites
                if (filteredBets.length === 0) {
                    const emptyMessage = document.createElement('div');
                    emptyMessage.className = 'col-span-full text-center p-6 text-gray-500 dark:text-gray-400';
                    emptyMessage.innerHTML = `
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 mx-auto mb-3 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                        </svg>
                        <p class="text-lg font-medium">Nenhum palpite nesta categoria</p>
                        <p class="mt-1">Tente gerar mais palpites ou ajustar a distribuição.</p>
                    `;
                    betsGrid.appendChild(emptyMessage);
                    return;
                }
                
                // Renderizar cada palpite
                filteredBets.forEach(bet => {
                    // Definir classe de categoria
                    let categoryClass = '';
                    let categoryLabel = '';
                    
                    if (bet.category === 'low') {
                        categoryClass = 'border-l-4 border-green-500';
                        categoryLabel = 'Baixas';
                    } else if (bet.category === 'medium') {
                        categoryClass = 'border-l-4 border-yellow-500';
                        categoryLabel = 'Médias';
                    } else if (bet.category === 'high') {
                        categoryClass = 'border-l-4 border-red-500';
                        categoryLabel = 'Altas';
                    }
                    
                    const card = document.createElement('div');
                    card.className = `bg-white dark:bg-gray-800 shadow-md rounded p-4 ${categoryClass}`;
                    
                    let numbersHTML = '';
                    bet.numbers.forEach(numStr => {
                        const num = parseInt(numStr);
                        const categoryClass = getNumberCategoryClass(num);
                        numbersHTML += `<span class="inline-block ${categoryClass} rounded-full px-3 py-1 text-sm font-semibold">${numStr}</span>`;
                    });
                    
                    card.innerHTML = `
                        <div class="font-semibold text-primary mb-2">Palpite #${bet.index} - Dígitos: ${bet.combination}</div>
                        <div class="flex flex-wrap gap-2 mb-2">
                            ${numbersHTML}
                        </div>
                        <div class="flex justify-between items-center">
                            <div class="text-xs text-gray-500 dark:text-gray-400">
                                <span class="text-green-600 dark:text-green-400">${bet.distribution.low} baixas</span> | 
                                <span class="text-yellow-600 dark:text-yellow-400">${bet.distribution.medium} médias</span> | 
                                <span class="text-red-600 dark:text-red-400">${bet.distribution.high} altas</span>
                            </div>
                            <span class="px-2 py-1 text-xs rounded-full ${
                                bet.category === 'low' ? 'bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200' : 
                                bet.category === 'medium' ? 'bg-yellow-100 dark:bg-yellow-900 text-yellow-800 dark:text-yellow-200' : 
                                'bg-red-100 dark:bg-red-900 text-red-800 dark:text-red-200'
                            }">${categoryLabel}</span>
                        </div>
                    `;
                    
                    betsGrid.appendChild(card);
                });
            }
            
            // Função para colar os palpites
            function copyBetsToClipboard() {
                if (state.generatedBets.length === 0) {
                    alert('Não há palpites para copiar. Gere os palpites primeiro.');
                    return;
                }
                
                let text = '';
                state.generatedBets.forEach(bet => {
                    text += bet.numbers.join(' ') + '\n';
                });
                
                navigator.clipboard.writeText(text)
                    .then(() => {
                        alert(`${state.generatedBets.length} palpites copiados para a área de transferência!`);
                    })
                    .catch(err => {
                        console.error('Erro ao copiar: ', err);
                        alert('Não foi possível copiar o texto. Por favor, tente novamente.');
                    });
            }
            
            // Função para baixar os palpites
            function downloadBets() {
                if (state.generatedBets.length === 0) {
                    alert('Não há palpites para baixar. Gere os palpites primeiro.');
                    return;
                }
                
                const numbersPerBet = parseInt(document.getElementById('numberPerBet').value);
                const lowRange = parseInt(document.getElementById('lowRange').value);
                const mediumRange = parseInt(document.getElementById('mediumRange').value);
                const highRange = parseInt(document.getElementById('highRange').value);
                
                let text = `PALPITES GERADOS - DIA DE SORTE\n`;
                text += `Combinações de ${state.currentGroupSize} dígitos utilizadas (${state.mode === 'undrawn' ? 'não sorteadas' : 'todas'})\n`;
                text += `Números por palpite: ${numbersPerBet}\n`;
                text += `Distribuição pretendida: ${lowRange} baixas, ${mediumRange} médias, ${highRange} altas\n`;
                text += `Data de geração: ${new Date().toLocaleDateString()}\n\n`;
                
                // Adicionar estatísticas
                text += `RESUMO DOS PALPITES:\n`;
                text += `Total de palpites gerados: ${state.generatedBets.length}\n`;
                text += `Palpites com predominância de dezenas baixas (1-10): ${document.getElementById('lowBetsCount').textContent}\n`;
                text += `Palpites com predominância de dezenas médias (11-20): ${document.getElementById('mediumBetsCount').textContent}\n`;
                text += `Palpites com predominância de dezenas altas (21-31): ${document.getElementById('highBetsCount').textContent}\n\n`;
                
                // Adicionar cada palpite
                state.generatedBets.forEach(bet => {
                    text += `Palpite #${bet.index} - Dígitos: ${bet.combination}\n`;
                    text += `Números: ${bet.numbers.join(' ')}\n`;
                    text += `Distribuição: ${bet.distribution.low} baixas, ${bet.distribution.medium} médias, ${bet.distribution.high} altas\n\n`;
                });
                
                const blob = new Blob([text], { type: 'text/plain' });
                const url = URL.createObjectURL(blob);
                
                const a = document.createElement('a');
                a.href = url;
                a.download = `palpites_dia_de_sorte_${state.currentGroupSize}_digitos.txt`;
                document.body.appendChild(a);
                a.click();
                
                setTimeout(() => {
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                }, 100);
            }
            
            // Função para copiar combinações
            function copyAllCombinations() {
                const text = state.validCombinations.join('\n');
                navigator.clipboard.writeText(text)
                    .then(() => {
                        alert(`${state.validCombinations.length} combinações copiadas para a área de transferência!`);
                    })
                    .catch(err => {
                        console.error('Erro ao copiar: ', err);
                        alert('Não foi possível copiar o texto. Por favor, tente novamente.');
                    });
            }
            
            // Função para baixar combinações
            function downloadCombinations() {
                const text = `COMBINAÇÕES DE ${state.currentGroupSize} DÍGITOS - DIA DE SORTE\n\n` + 
                             state.validCombinations.join('\n');
                
                const blob = new Blob([text], { type: 'text/plain' });
                const url = URL.createObjectURL(blob);
                
                const a = document.createElement('a');
                a.href = url;
                a.download = `combinacoes_${state.currentGroupSize}_digitos.txt`;
                document.body.appendChild(a);
                a.click();
                
                setTimeout(() => {
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                }, 100);
            }
            
            // Função para copiar combinações não sorteadas
            function copyUndrawnCombinations() {
                if (state.undrawnCombinations.length === 0) {
                    alert('Não há combinações não sorteadas para copiar.');
                    return;
                }
                
                const text = state.undrawnCombinations.join('\n');
                navigator.clipboard.writeText(text)
                    .then(() => {
                        alert(`${state.undrawnCombinations.length} combinações não sorteadas copiadas para a área de transferência!`);
                    })
                    .catch(err => {
                        console.error('Erro ao copiar: ', err);
                        alert('Não foi possível copiar o texto. Por favor, tente novamente.');
                    });
            }
            
            // Função para baixar combinações não sorteadas
            function downloadUndrawnCombinations() {
                if (state.undrawnCombinations.length === 0) {
                    alert('Não há combinações não sorteadas para baixar.');
                    return;
                }
                
                const text = `COMBINAÇÕES DE ${state.currentGroupSize} DÍGITOS AINDA NÃO SORTEADAS - DIA DE SORTE\n\n` + 
                             state.undrawnCombinations.join('\n');
                
                const blob = new Blob([text], { type: 'text/plain' });
                const url = URL.createObjectURL(blob);
                
                const a = document.createElement('a');
                a.href = url;
                a.download = `combinacoes_${state.currentGroupSize}_digitos_nao_sorteadas.txt`;
                document.body.appendChild(a);
                a.click();
                
                setTimeout(() => {
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                }, 100);
            }
            
            // Inicialização
            function initialize() {
                // Configurar as abas
                setupTabs();
                
                // Inicializar as combinações
                updateCombinations();
                
                // Inicializar a distribuição por faixa
                setupRangeDistribution();
                
                // Event listeners para os botões de tamanho de grupo
                document.querySelectorAll('.digit-size-btn').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const size = parseInt(this.getAttribute('data-size'));
                        state.currentGroupSize = size;
                        state.mode = 'all'; // Resetar para modo "todas" ao mudar o tamanho
                        updateCombinations();
                    });
                });
                
                // Event listeners para a funcionalidade geral
                document.getElementById('copyAllBtn').addEventListener('click', copyAllCombinations);
                document.getElementById('downloadCombinationsBtn').addEventListener('click', downloadCombinations);
                document.getElementById('analyzeBtn').addEventListener('click', analyzeFrequency);
                document.getElementById('useUndrawnBtn').addEventListener('click', useUndrawnCombinations);
                document.getElementById('copyUndrawnBtn').addEventListener('click', copyUndrawnCombinations);
                document.getElementById('downloadUndrawnBtn').addEventListener('click', downloadUndrawnCombinations);
                document.getElementById('generateBetsBtn').addEventListener('click', generateBets);
                document.getElementById('downloadBetsBtn').addEventListener('click', downloadBets);
                document.getElementById('copyBetsBtn').addEventListener('click', copyBetsToClipboard);
                document.getElementById('printBetsBtn').addEventListener('click', () => window.print());
                document.getElementById('clearBetsBtn').addEventListener('click', () => {
                    state.generatedBets = [];
                    document.getElementById('betResultsContainer').classList.add('hidden');
                    document.getElementById('generatedBetsCount').textContent = '0';
                });
                
                // Event listeners para as abas de palpites
                document.getElementById('allBetsTab').addEventListener('click', function() {
                    // Atualizar classes das abas
                    document.querySelectorAll('.tabs button').forEach(tab => {
                        tab.classList.remove('tab-active');
                        tab.classList.add('tab-inactive');
                    });
                    this.classList.remove('tab-inactive');
                    this.classList.add('tab-active');
                    
                    renderBets('all');
                });
                
                document.getElementById('lowBetsTab').addEventListener('click', function() {
                    // Atualizar classes das abas
                    document.querySelectorAll('.tabs button').forEach(tab => {
                        tab.classList.remove('tab-active');
                        tab.classList.add('tab-inactive');
                    });
                    this.classList.remove('tab-inactive');
                    this.classList.add('tab-active');
                    
                    renderBets('low');
                });
                
                document.getElementById('mediumBetsTab').addEventListener('click', function() {
                    // Atualizar classes das abas
                    document.querySelectorAll('.tabs button').forEach(tab => {
                        tab.classList.remove('tab-active');
                        tab.classList.add('tab-inactive');
                    });
                    this.classList.remove('tab-inactive');
                    this.classList.add('tab-active');
                    
                    renderBets('medium');
                });
                
                document.getElementById('highBetsTab').addEventListener('click', function() {
                    // Atualizar classes das abas
                    document.querySelectorAll('.tabs button').forEach(tab => {
                        tab.classList.remove('tab-active');
                        tab.classList.add('tab-inactive');
                    });
                    this.classList.remove('tab-inactive');
                    this.classList.add('tab-active');
                    
                    renderBets('high');
                });
                
                // Event listener para o gerador de números possíveis
                document.getElementById('generateNumbersBtn').addEventListener('click', function() {
                    const combinationInput = document.getElementById('specificCombination').value.trim();
                    if (!combinationInput) {
                        alert('Por favor, digite uma combinação válida.');
                        return;
                    }
                    
                    // Verificar formato
                    const digits = combinationInput.split(',').map(d => d.trim());
                    if (digits.some(d => !/^\d$/.test(d))) {
                        alert('Formato inválido. Use dígitos separados por vírgula (ex: 1,3,5,7,9)');
                        return;
                    }
                    
                    // Gerar números possíveis
                    const possibleNumbers = generatePossibleNumbers(digits.join(','));
                    
                    // Exibir resultados
                    const container = document.getElementById('possibleNumbersContainer');
                    const grid = document.getElementById('possibleNumbersGrid');
                    const count = document.getElementById('possibleNumbersCount');
                    const selectedCombo = document.getElementById('selectedCombination');
                    
                    container.classList.remove('hidden');
                    grid.innerHTML = '';
                    selectedCombo.textContent = digits.join(',');
                    count.textContent = possibleNumbers.length;
                    
                    possibleNumbers.forEach(num => {
                        const numSpan = document.createElement('span');
                        numSpan.className = `inline-block ${getNumberCategoryClass(num)} rounded-full px-3 py-1 text-sm font-semibold`;
                        numSpan.textContent = formatNumber(num);
                        grid.appendChild(numSpan);
                    });
                });
                
                // Configurações das APIs e handlers de busca de resultados
                setupAPIHandlers();
            }
            
            // Configurar handlers para APIs
            function setupAPIHandlers() {
                // TODO: Implementar funções para buscar resultados da API
                document.getElementById('fetchResultsBtn').addEventListener('click', fetchResultsFromAPIs);
            }
            
            // Função genérica para tentar acessar uma URL via múltiplos proxies CORS
            async function fetchViaProxy(baseUrl, customHeaders = {}) {
                // Tenta cada proxy disponível
                for (const proxyUrl of API_CONFIG.CORS_PROXY_URLS) {
                    try {
                        // Constrói a URL com o proxy
                        const url = proxyUrl.includes('?url=') ? 
                            `${proxyUrl}${encodeURIComponent(baseUrl)}` : 
                            `${proxyUrl}${baseUrl}`;
                        
                        console.log(`Tentando via proxy: ${url}`);
                        
                        const response = await fetch(url, {
                            method: 'GET',
                            headers: {
                                'Accept': 'application/json',
                                ...customHeaders
                            },
                            mode: 'cors'
                        });
                        
                        if (response.ok) {
                            return await response.json();
                        }
                    } catch (proxyError) {
                        console.log(`Proxy falhou (${proxyUrl}):`, proxyError);
                        // Continua para o próximo proxy
                    }
                }
                
                throw new Error('Nenhum proxy CORS conseguiu acessar a URL');
            }
            
            // ===== API CAIXA =====
            async function fetchFromCaixaAPI(concursoNum = null, useProxy = false) {
                try {
                    // Verificar cache primeiro
                    const cacheKey = concursoNum ? 
                        `caixa_dia_de_sorte_${concursoNum}` : 
                        'caixa_dia_de_sorte_latest';
                    
                    const cachedData = LOCAL_CACHE.getCached(cacheKey);
                    
                    if (cachedData) {
                        console.log('Usando dados em cache para:', cacheKey);
                        return {
                            success: true,
                            message: `Sucesso! Dados obtidos do cache local (${cachedData.length} concursos).`,
                            formattedResults: cachedData.join('\n'),
                            source: 'cache'
                        };
                    }
                    
                    // Constrói a URL baseada no parâmetro de concurso
                    const url = concursoNum ? 
                        `${API_CONFIG.CAIXA_URL}/${concursoNum}` : 
                        API_CONFIG.CAIXA_URL;
                    
                    let data;
                    
                    if (useProxy) {
                        // Acesso via proxy CORS
                        console.log(`Buscando dados da Caixa via proxy: ${url}`);
                        data = await fetchViaProxy(url, {
                            'Origin': 'https://loterias.caixa.gov.br',
                            'Referer': 'https://loterias.caixa.gov.br/'
                        });
                    } else {
                        // Acesso direto
                        console.log(`Buscando dados da Caixa diretamente: ${url}`);
                        const response = await fetch(url, {
                            method: 'GET',
                            headers: {
                                'Accept': 'application/json',
                                'Content-Type': 'application/json',
                                'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36',
                                'Origin': 'https://loterias.caixa.gov.br',
                                'Referer': 'https://loterias.caixa.gov.br/'
                            },
                            mode: 'cors',
                            credentials: 'omit'
                        });
                        
                        if (!response.ok) {
                            throw new Error(`Status HTTP: ${response.status}`);
                        }
                        
                        data = await response.json();
                    }
                    
                    console.log("Resposta da API Caixa:", data);
                    
                    if (data && data.listaDezenas && Array.isArray(data.listaDezenas)) {
                        const allResults = [data.listaDezenas.join(' ')];
                        LOCAL_CACHE.setCached(cacheKey, allResults, 60); // Cache por 60 minutos
                        
                        return {
                            success: true,
                            message: `Sucesso! Dados obtidos da API oficial da Caixa (concurso ${data.numero}) ${useProxy ? 'via proxy' : 'diretamente'}.`,
                            formattedResults: allResults.join('\n'),
                            source: useProxy ? 'caixa-proxy' : 'caixa'
                        };
                    } else {
                        throw new Error('Formato de dados inválido ou inesperado');
                    }
                } catch (error) {
                    console.error(`Erro ao acessar API Caixa ${useProxy ? 'via proxy' : 'diretamente'}:`, error);
                    return {
                        success: false,
                        message: `Falha na API Caixa ${useProxy ? '(via proxy)' : '(acesso direto)'}: ${error.message}`
                    };
                }
            }
            
            // ===== API HEROKU =====
            async function fetchFromHerokuAPI(useProxy = false) {
                try {
                    // Verificar cache primeiro
                    const cacheKey = 'heroku_dia_de_sorte';
                    const cachedData = LOCAL_CACHE.getCached(cacheKey);
                    
                    if (cachedData) {
                        console.log('Usando dados em cache para Heroku API');
                        return {
                            success: true,
                            message: 'Sucesso! Dados obtidos do cache local (API Heroku).',
                            formattedResults: cachedData,
                            source: 'cache'
                        };
                    }
                    
                    let data;
                    
                    if (useProxy) {
                        // Acesso via proxy CORS
                        console.log(`Buscando dados da Heroku API via proxy`);
                        data = await fetchViaProxy(API_CONFIG.HEROKU_URL);
                    } else {
                        // Acesso direto  
                        console.log(`Buscando dados da Heroku API diretamente`);
                        const response = await fetch(API_CONFIG.HEROKU_URL, {
                            method: 'GET',
                            headers: {
                                'Accept': 'application/json'
                            }
                        });
                        
                        if (!response.ok) {
                            throw new Error(`Status ${response.status}`);
                        }
                        
                        data = await response.json();
                    }
                    
                    console.log("Resposta da API Heroku:", data);
                    
                    if (data && Array.isArray(data)) {
                        const formattedResults = data.map(contest => {
                            return contest.dezenas.join(' ');
                        }).join('\n');
                        
                        // Armazenar em cache
                        LOCAL_CACHE.setCached(cacheKey, formattedResults, 60); // Cache por 60 minutos
                        
                        return {
                            success: true,
                            message: `Sucesso! Dados obtidos da API Heroku (${data.length} concursos) ${useProxy ? 'via proxy' : 'diretamente'}.`,
                            formattedResults: formattedResults,
                            source: useProxy ? 'heroku-proxy' : 'heroku'
                        };
                    } else {
                        throw new Error('Formato de dados inválido');
                    }
                } catch (error) {
                    console.error(`Erro ao acessar API Heroku ${useProxy ? 'via proxy' : 'diretamente'}:`, error);
                    return {
                        success: false,
                        message: `Falha na API Heroku ${useProxy ? '(via proxy)' : '(acesso direto)'}: ${error.message}`
                    };
                }
            }
            
            // ===== API BRASIL =====
            async function fetchFromBrasilAPI(useProxy = false) {
                try {
                    // Verificar cache primeiro
                    const cacheKey = 'brasil_dia_de_sorte';
                    const cachedData = LOCAL_CACHE.getCached(cacheKey);
                    
                    if (cachedData) {
                        console.log('Usando dados em cache para Brasil API');
                        return {
                            success: true,
                            message: 'Sucesso! Dados obtidos do cache local (API Brasil).',
                            formattedResults: cachedData,
                            source: 'cache'
                        };
                    }
                    
                    let data;
                    
                    if (useProxy) {
                        // Acesso via proxy CORS
                        console.log(`Buscando dados da Brasil API via proxy`);
                        data = await fetchViaProxy(API_CONFIG.BRASIL_URL);
                    } else {
                        // Acesso direto
                        console.log(`Buscando dados da Brasil API diretamente`);
                        const response = await fetch(API_CONFIG.BRASIL_URL, {
                            method: 'GET',
                            headers: {
                                'Accept': 'application/json'
                            }
                        });
                        
                        if (!response.ok) {
                            throw new Error(`Status ${response.status}`);
                        }
                        
                        data = await response.json();
                    }
                    
                    console.log("Resposta da API Brasil:", data);
                    
                    if (data && data.concursos && Array.isArray(data.concursos)) {
                        const formattedResults = data.concursos.map(contest => {
                            return contest.numeros.join(' ');
                        }).join('\n');
                        
                        // Armazenar em cache
                        LOCAL_CACHE.setCached(cacheKey, formattedResults, 60);
                        
                        return {
                            success: true,
                            message: `Sucesso! Dados obtidos da API Brasil (${data.concursos.length} concursos) ${useProxy ? 'via proxy' : 'diretamente'}.`,
                            formattedResults: formattedResults,
                            source: useProxy ? 'brasil-proxy' : 'brasil'
                        };
                    } else {
                        throw new Error('Formato de dados inválido');
                    }
                } catch (error) {
                    console.error(`Erro ao acessar API Brasil ${useProxy ? 'via proxy' : 'diretamente'}:`, error);
                    return {
                        success: false,
                        message: `Falha na API Brasil ${useProxy ? '(via proxy)' : '(acesso direto)'}: ${error.message}`
                    };
                }
            }
            
            // Função principal para buscar resultados de acordo com as configurações do usuário
            async function fetchResultsFromAPIs() {
                const spinner = document.getElementById('loadingSpinner');
                const fetchText = document.getElementById('fetchText');
                const apiStatus = document.getElementById('apiStatus');
                const apiStatusContent = document.getElementById('apiStatusContent');
                const apiSelect = document.getElementById('apiSelect');
                const modeSelect = document.getElementById('modeSelect');
                
                const selectedAPI = apiSelect.value;
                const accessMode = modeSelect.value; // direct, proxy, or both
                
                // Obter o número do concurso (se fornecido)
                const concursoInput = document.getElementById('concursoNum');
                const concursoNum = concursoInput.value ? parseInt(concursoInput.value) : null;
                
                // Show loading spinner and status
                spinner.classList.remove('hidden');
                fetchText.textContent = 'Buscando...';
                apiStatus.classList.remove('hidden');
                apiStatusContent.innerHTML = 'Iniciando busca de resultados...';
                
                if (concursoNum) {
                    apiStatusContent.innerHTML += `<br>Buscando dados do concurso ${concursoNum}...`;
                }
                
                // Clear any previous results
                document.getElementById('historicalResults').value = '';
                
                try {
                    // Se uma API específica foi selecionada
                    if (selectedAPI !== 'auto') {
                        apiStatusContent.innerHTML += `<br>API selecionada: ${selectedAPI}`;
                        
                        let result = null;
                        
                        // Tenta obter dados de acordo com o modo selecionado
                        if (accessMode === 'direct' || accessMode === 'both') {
                            apiStatusContent.innerHTML += '<br>Tentando acesso direto...';
                            
                            switch (selectedAPI) {
                                case 'caixa':
                                    result = await fetchFromCaixaAPI(concursoNum, false);
                                    break;
                                case 'heroku':
                                    result = await fetchFromHerokuAPI(false);
                                    break;
                                case 'brasilapi':
                                    result = await fetchFromBrasilAPI(false);
                                    break;
                            }
                            
                            if (result && result.success) {
                                apiStatusContent.innerHTML += `<br>✅ ${result.message}`;
                                document.getElementById('historicalResults').value = result.formattedResults;
                                analyzeFrequency();
                                
                                spinner.classList.add('hidden');
                                fetchText.textContent = 'Buscar Resultados';
                                return;
                            } else if (result) {
                                apiStatusContent.innerHTML += `<br>❌ ${result.message}`;
                            }
                        }
                        
                        // Se o modo direto falhou ou foi pulado, tenta via proxy
                        if (accessMode === 'proxy' || accessMode === 'both') {
                            apiStatusContent.innerHTML += '<br>Tentando acesso via proxy CORS...';
                            
                            switch (selectedAPI) {
                                case 'caixa':
                                    result = await fetchFromCaixaAPI(concursoNum, true);
                                    break;
                                case 'heroku':
                                    result = await fetchFromHerokuAPI(true);
                                    break;
                                case 'brasilapi':
                                    result = await fetchFromBrasilAPI(true);
                                    break;
                            }
                            
                            if (result && result.success) {
                                apiStatusContent.innerHTML += `<br>✅ ${result.message}`;
                                document.getElementById('historicalResults').value = result.formattedResults;
                                analyzeFrequency();
                                
                                spinner.classList.add('hidden');
                                fetchText.textContent = 'Buscar Resultados';
                                return;
                            } else if (result) {
                                apiStatusContent.innerHTML += `<br>❌ ${result.message}`;
                            }
                        }
                        
                        // Se chegou aqui, todas as tentativas falharam
                        apiStatusContent.innerHTML += '<br>❌ Todas as tentativas falharam para a API selecionada.';
                        apiStatusContent.innerHTML += '<br>⚠️ Tente outra API ou modifique os parâmetros da busca.';
                    } else {
                        // Modo automático - tenta todas as APIs
                        apiStatusContent.innerHTML += '<br>Modo automático: testando múltiplas APIs...';
                        
                        // Array com todas as combinações de API e modo de acesso para tentar
                        const apiOptions = [
                            // Primeiro tenta Heroku (geralmente mais confiável)
                            { name: 'heroku', fn: fetchFromHerokuAPI, params: [false], label: 'Heroku (direto)' },
                            { name: 'heroku', fn: fetchFromHerokuAPI, params: [true], label: 'Heroku (proxy)' },
                            
                            // Depois Caixa
                            { name: 'caixa', fn: fetchFromCaixaAPI, params: [concursoNum, false], label: 'Caixa (direto)' },
                            { name: 'caixa', fn: fetchFromCaixaAPI, params: [concursoNum, true], label: 'Caixa (proxy)' },
                            
                            // Por último Brasil
                            { name: 'brasilapi', fn: fetchFromBrasilAPI, params: [false], label: 'Brasil (direto)' },
                            { name: 'brasilapi', fn: fetchFromBrasilAPI, params: [true], label: 'Brasil (proxy)' }
                        ];
                        
                        // Tentar cada combinação de API e modo de acesso
                        for (const option of apiOptions) {
                            apiStatusContent.innerHTML += `<br>Tentando API ${option.label}...`;
                            
                            try {
                                const result = await option.fn(...option.params);
                                
                                if (result.success) {
                                    apiStatusContent.innerHTML += `<br>✅ ${result.message}`;
                                    document.getElementById('historicalResults').value = result.formattedResults;
                                    analyzeFrequency();
                                    
                                    spinner.classList.add('hidden');
                                    fetchText.textContent = 'Buscar Resultados';
                                    return;
                                } else {
                                    apiStatusContent.innerHTML += `<br>❌ ${result.message}`;
                                }
                            } catch (apiError) {
                                apiStatusContent.innerHTML += `<br>❌ Erro inesperado: ${apiError.message}`;
                            }
                        }
                        
                        // Se chegou aqui, todas as APIs falharam
                        apiStatusContent.innerHTML += '<br>❌ Todas as APIs falharam.';
                        apiStatusContent.innerHTML += '<br>⚠️ Sugestões:';
                        apiStatusContent.innerHTML += '<br>1. Verifique sua conexão com a internet';
                        apiStatusContent.innerHTML += '<br>2. Tente novamente mais tarde';
                        apiStatusContent.innerHTML += '<br>3. Insira manualmente os resultados da loteria';
                    }
                } catch (error) {
                    apiStatusContent.innerHTML += `<br>❌ Erro geral: ${error.message}`;
                    apiStatusContent.innerHTML += '<br>⚠️ Por favor, tente novamente ou insira os dados manualmente.';
                } finally {
                    spinner.classList.add('hidden');
                    fetchText.textContent = 'Buscar Resultados';
                }
            }
            
            initialize();
        });
    </script>
    
    <footer>Feito por: <i>Márcio Fernando Maia - Todos os direitos reservados - 2025</i></footer>
</body>
</html>